## Run your MCP client and log in

Now, with your server running in a separate terminal window, run the [MCP Inspector](https://modelcontextprotocol.io/docs/tools/inspector):

```shell
npx @modelcontextprotocol/inspector@latest
```

This will open the MCP Inspector interface on your default browser.

<Frame>
  <img
    src="/img/mcp/mcp_inspector_configured.png"
    alt="MCP Inspector page after running it"
  />
</Frame>

In the MCP Inspector, select `Streamable HTTP` as the **Transport Type** and enter `http://localhost:3001/mcp` as the URL.

Open the Authentication menu on the navigation menu on the left, and add the `Client ID` and `Client Secret` from the [client creation step](#create-an-application-to-represent-your-mcp-client) in the corresponding fields and click **Connect.**

When you connect to the server for the first time you will be guided through the authentication process using the Auth0 Universal Login. You’ll see the consent screen where you can check the tools you have access:

<Frame>
  <img
    class="img-sizing"
    src="/img/mcp/consent_screen_while_logging_in.png"
    alt="Consent modal while authenticating"
  />
</Frame>

Use the same user you gave access to the tools in the previous step. You can sign in with that account on future visits.

<Info>If you don’t see tools listed on the consent screen that’s because you are not logging in with the correct user</Info>

<Frame>
  <img
    src="/img/mcp/mcp_inspector_after_login.png"
    alt="MCP Inspector page after running it"
  />
</Frame>

Below you find the code for the server configuration:

```javascript wrap lines expandable
import "dotenv/config";

import { FastMCP } from "fastmcp";
import { FastMCPAuthSession } from "./types.js";
import { MCP_TOOL_SCOPES, registerTools } from "./tools.js";
import { authenticate } from "./auth0.js";

const PORT = parseInt(process.env.PORT ?? "3001", 10);
const AUTH0_DOMAIN = process.env.AUTH0_DOMAIN as string;
const AUTH0_AUDIENCE = process.env.AUTH0_AUDIENCE as string;

export const server = new FastMCP<FastMCPAuthSession>({
  name: "FastMCP Auth0 Example Server",
  version: "1.0.0",
  authenticate,
  oauth: {
    enabled: true,
    protectedResource: {
      resource: AUTH0_AUDIENCE,
      authorizationServers: [`https://${AUTH0_DOMAIN}/`],
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
    authorizationServer: {
      issuer: `https://${AUTH0_DOMAIN}/`,
      authorizationEndpoint: `https://${AUTH0_DOMAIN}/authorize`,
      tokenEndpoint: `https://${AUTH0_DOMAIN}/oauth/token`,
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      responseTypesSupported: ["code"],
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
  },
});

const start = async () => {
  registerTools(server);

  try {
    await server.start({
      transportType: "httpStream",
      httpStream: {
        port: PORT,
        endpoint: "/mcp",
        stateless: true,
      },
    });
  } catch (err) {
    console.error(err);
    process.exit(1);
  }
};

start();
```

Let’s break it down.

The FastMCP will call the `authenticate` function [implemented here](https://github.com/auth0-samples/auth0-ai-samples/blob/main/auth-for-mcp/fastmcp-mcp-js/src/auth0.ts) to authenticate the request before creating a new session.

```javascript highlight={5}
// ...
export const server = new FastMCP<FastMCPAuthSession>({
  name: "FastMCP Auth0 Example Server",
  version: "1.0.0",
  authenticate,
  oauth: {
    enabled: true,
    protectedResource: {
      resource: AUTH0_AUDIENCE,
      authorizationServers: [`https://${AUTH0_DOMAIN}/`],
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
    authorizationServer: {
      issuer: `https://${AUTH0_DOMAIN}/`,
      authorizationEndpoint: `https://${AUTH0_DOMAIN}/authorize`,
      tokenEndpoint: `https://${AUTH0_DOMAIN}/oauth/token`,
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      responseTypesSupported: ["code"],
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
  },
});

// ...
```

The `oauth` configuration implements the OAuth server discovery by enabling the RFC-compliant OAuth endpoints

* Only active when server runs with HTTP-based transports (`httpStream` or `SSE`)
* Ignored completely for `stdio` transport layer

```javascript highlight={6-21}
// ...
export const server = new FastMCP<FastMCPAuthSession>({
  name: "FastMCP Auth0 Example Server",
  version: "1.0.0",
  authenticate,
  oauth: {
    enabled: true,
    protectedResource: {
      resource: AUTH0_AUDIENCE,
      authorizationServers: [`https://${AUTH0_DOMAIN}/`],
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
    authorizationServer: {
      issuer: `https://${AUTH0_DOMAIN}/`,
      authorizationEndpoint: `https://${AUTH0_DOMAIN}/authorize`,
      tokenEndpoint: `https://${AUTH0_DOMAIN}/oauth/token`,
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      responseTypesSupported: ["code"],
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
  },
});
// ...
```

The `protectedResource` configuration is responsible for exposing the `/.well-known/oauth-protected-resource` endpoint and tells OAuth clients:

* What resource they're accessing (audience)
* Which authorization servers can issue valid tokens
* Where to find public keys for token verification

```javascript highlight={8-13}
// ...
export const server = new FastMCP<FastMCPAuthSession>({
  name: "FastMCP Auth0 Example Server",
  version: "1.0.0",
  authenticate,
  oauth: {
    enabled: true,
    protectedResource: {
      resource: AUTH0_AUDIENCE,
      authorizationServers: [`https://${AUTH0_DOMAIN}/`],
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
    authorizationServer: {
      issuer: `https://${AUTH0_DOMAIN}/`,
      authorizationEndpoint: `https://${AUTH0_DOMAIN}/authorize`,
      tokenEndpoint: `https://${AUTH0_DOMAIN}/oauth/token`,
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      responseTypesSupported: ["code"],
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
  },
});
// ...
```

The `authorizationServer` configuration is responsible for exposing the `/.well-known/oauth-authorization-server` endpoint. This enables backward compatibility with MCP clients using earlier versions of the MCP Authorization spec (such as [revision 2025-03-26](https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization#server-metadata-discovery)) that expect authorization server metadata to be available directly from the MCP server. If your MCP clients have been upgraded to [revision 2025-06-18](https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization) or later, this block is not required

```javascript highlight={14-21}
// ...
export const server = new FastMCP<FastMCPAuthSession>({
  name: "FastMCP Auth0 Example Server",
  version: "1.0.0",
  authenticate,
  oauth: {
    enabled: true,
    protectedResource: {
      resource: AUTH0_AUDIENCE,
      authorizationServers: [`https://${AUTH0_DOMAIN}/`],
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
    authorizationServer: {
      issuer: `https://${AUTH0_DOMAIN}/`,
      authorizationEndpoint: `https://${AUTH0_DOMAIN}/authorize`,
      tokenEndpoint: `https://${AUTH0_DOMAIN}/oauth/token`,
      jwksUri: `https://${AUTH0_DOMAIN}/.well-known/jwks.json`,
      responseTypesSupported: ["code"],
      scopesSupported: ["openid", "profile", "email", ...MCP_TOOL_SCOPES],
    },
  },
});
// ...
```

## Run your tools

Users with the **Tool User** role will only see the `whoami` tool:

<Frame>
  <img
    src="/img/mcp/tools_list_tool_user_role.png"
    alt="List of tools for an user with the Tool User role"
  />
</Frame>

Whereas users with the **Tool Administrator** role will see both the `greet` and the `whoami` tools:

<Frame>
  <img
    src="/img/mcp/tools_list_tool_administrator_role.png"
    alt="List of tools for an user with the Tool Administrator role"
  />
</Frame>

Now, click on the tool you want to use and **Run Tool**.

<Frame>
  <img
    src="/img/mcp/whoami_tool_call_through_mcp_inspector.png"
    alt="WhoAmI tool call response in MCP Inspector"
  />
</Frame>
