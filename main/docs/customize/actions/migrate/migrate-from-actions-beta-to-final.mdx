---
description: Learn how to migrate to Actions from Rules, Hooks, and earlier versions
  of Actions.
'og:image': https://cdn2.auth0.com/docs/1.14553.0/img/share-image.png
'og:title': Migrate to Actions
'og:url': https://auth0.com/docs/
permalink: migrate-from-actions-beta-to-final
title: Migrate from Actions Beta to Final
'twitter:description': Learn how to migrate to Actions from Rules, Hooks, and earlier
  versions of Actions.
'twitter:title': Migrate to Actions
---
As part of our long-term vision for extensibility of Auth0 through custom code, we have refined and simplified the programming models that we introduced during the beta period of Actions. Authoring Actions will now be done in a more consistent and predictable way across Triggers. Event data has been aligned more closely with the [Auth0 Management API](https://auth0.com/docs/api/management/v2) and other facets of the Auth0 platform. Changing the behavior of the transaction via custom code now always happens by calling methods of a new `api` argument.

Migrating an Action created during the period prior to [General Availability (GA)](/troubleshoot/product-lifecycle/product-release-stages#general-availability) should typically involve the following steps:

1. Adjust references to renamed and relocated event properties as outlined in the [Breaking changes](#breaking-changes) section.
2. Instead of composing and returning an object describing the desired side-effects, update custom code to call the relevant `api` method as outlined in the [Performing side effects](#performing-side-effects) section.
3. For Actions that need to handle redirect callbacks, use the newly-exposed dedicated function. If you used code that relied on `event.protocol === 'redirect-callback'`, review the [Redirect with Actions](/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/redirect-with-actions) page.

## Breaking changes

### Query and body parameters

Direct access to the query and body parameters is available using the `event.request.query` and `event.request.body` objects. These are exposed regardless of whether the authorization was initiated via a `GET` or `POST` request. Many protocol-specific query or body parameters sent as part of an authorization request are now also available as first-class values on the `event.transaction` object. We recommend that you use `event.transaction` rather than `event.request.query` and `event.request.body` unless your use case is not supported. A complete mapping of these changes is below:

<table class="table"><thead>
<tr>
<th>Pre-GA Property</th>
<th>GA Property</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event.actor.ip</code></td>
<td><code>event.request.ip</code></td>
</tr>
<tr>
<td><code>event.actor.hostname</code></td>
<td><code>event.request.hostname</code></td>
</tr>
<tr>
<td><code>event.actor.geoIp</code></td>
<td><code>event.request.geoip</code></td>
</tr>
<tr>
<td><code>event.actor.language</code></td>
<td><code>event.request.language</code></td>
</tr>
<tr>
<td><code>event.actor.method</code></td>
<td><code>event.request.method</code></td>
</tr>
<tr>
<td><code>event.actor.userAgent</code></td>
<td><code>event.request.user_agent</code></td>
</tr>
<tr>
<td><code>event.actor.body</code></td>
<td><code>event.request.body</code></td>
</tr>
<tr>
<td><code>event.actor.query</code></td>
<td><code>event.request.query</code></td>
</tr>
<tr>
<td><code>event.actor.query.audience</code></td>
<td><code>event.resource_server.identifier</code></td>
</tr>
<tr>
<td><code>event.actor.query.scope</code></td>
<td><code>event.transaction.requested_scopes</code></td>
</tr>
<tr>
<td><code>event.actor.query.acr_values</code></td>
<td><code>event.transaction.acr_values</code></td>
</tr>
<tr>
<td><code>event.actor.query.ui_locales</code></td>
<td><code>event.transaction.ui_locales</code></td>
</tr>
<tr>
<td><code>event.protocol</code></td>
<td><code>event.transaction.protocol</code></td>
</tr>
<tr>
<td><code>context.secrets</code></td>
<td><code>event.secrets</code></td>
</tr>
</tbody>
</table>

### User Profile properties

In general, the `event.user` object has had its properties changed from camel case to snake case in order to match the [Auth0 User Profile structure](/manage-users/user-accounts/user-profiles/user-profile-structure). For example, `event.user.appMetadata` has been changed to `event.user.app_metadata`.

### Performing side effects

In the pre-GA version of the post-login trigger, side effects were performed by returning an object from an Action. In Actions GA, an `api` object is provided to encapsulate these changes and provide better in-editor type hints and inline documentation.

#### Update user user_metadata

Pre-GA Trigger:

```js lines
async function myFunction(event, context) {
  return {
    user: {
      userMetadata: {
        myParam: "foo"
      }
    }
  };
}
```






GA Trigger:

```js lines
async function onExecutePostLogin(event, api) {
  api.user.setUserMetadata('myParam', 'foo');
}
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

You should not use this method in callbacks because invoking this method won't update metadata immediately. Instead, you can call this method several times throughout multiple Actions in the same flow (metadata set in one Action is applied to the transient object and is therefore available in subsequent Actions), and the engine will aggregate the changes and update the metadata all at once before the flow is completed.

</Callout>

#### Update user app_metadata

Pre-GA Trigger:

```js lines
async function myFunction(event, context) {
  return {
    user: {
      appMetadata: {
        myParam: "foo"
      }
    }
  };
}
```






GA Trigger:

```js lines
async function onExecutePostLogin(event, api) {
  api.user.setAppMetadata('myParam', 'foo');
}
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

You should not use this method in callbacks because invoking this method won't update metadata immediately. Instead, you can call this method several times throughout multiple Actions in the same flow (metadata set in one Action is applied to the transient object and is therefore available in subsequent Actions), and the engine will aggregate the changes and update the metadata all at once before the flow is completed.

</Callout>

### Deny a login

Pre-GA Trigger:

```js lines
async function myFunction(event, context) {
  throw new Error("Access denied.");
}
```






GA Trigger:

```js lines
async function onExecutePostLogin(event, api) {
  api.access.deny("Access denied.");
}
```






<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Throwing an error will also deny a login, but calling `api.access.deny` is the preferred approach.

</Callout>

### Add Custom Claims to the Access Token

Pre-GA Trigger:

```js lines
async function myFunc(event, context) {
  return {
    accessToken: {
      customClaims: {
        'https://example.com/custom/claim': 'Custom claim value',
      }
    }
  };
}
```






GA Trigger:

```js lines
async function myFunc(event, api) {
  api.accessToken.setCustomClaim('https://example.com/custom/claim', 'Custom claim value');
}
```






### Add Custom Claims to the ID Token

Pre-GA Trigger:

```js lines
async function myFunc(event, context) {
  return {
    idToken: {
      customClaims: {
        'https://example.com/custom/claim': 'Custom claim value',
      }
    }
  };
}
```






GA Trigger:

```js lines
async function myFunc(event, api) {
  api.idToken.setCustomClaim('https://example.com/custom/claim', 'Custom claim value');
}
```






### Dynamically enable multi-factor authentication

Pre-GA Trigger:

```js lines
async function myFunction(event, context) {
  return {
    command: {
      type: "multifactor",
      provider: "any"
    }
  };
}
```






GA Trigger:

```js lines
async function onExecutePostLogin(event, api) {
  api.multifactor.enable("duo");
}
```






### Redirect the user

Pre-GA Trigger:

```js lines
async function myFunction(event, context) {
  return {
    command: {
      type: "redirect",
      url: "https://my-app.example.com"
    }
  };
}
```






GA Trigger:

```js lines
async function onExecutePostLogin(event, api) {
  api.redirect.sendUserTo("https://my-app.example.com");
}
```






To ensure parameters are being sent securely and to avoid replay attacks, passing data via redirects has changed significantly in Actions GA. For more information, see [Redirect with Actions](/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger/redirect-with-actions).

### Manipulate scopes

Although we experimented with providing direct manipulation of ID and <Tooltip tip="Access Token: Authorization credential, in the form of an opaque string or JWT, used to access an API." cta="View Glossary" href="/glossary?term=Access+Token">Access Token</Tooltip> scopes during the Actions Beta, we do not support this functionality in Actions GA.