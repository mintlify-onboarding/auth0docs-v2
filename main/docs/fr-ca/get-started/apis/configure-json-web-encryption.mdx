---
title: "Configurer le chiffrement Web JSON (JWE)"
permalink: "configure-json-web-encryption"
'description': "Apprenez à configurer le chiffrement Web JSON (JWE) pour une API."
'og:title': "Configurer le chiffrement Web JSON (JWE)"
'og:description': "Apprenez à configurer le chiffrement Web JSON (JWE) pour une API."
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "Configurer le chiffrement Web JSON (JWE)"
'twitter:description': "Apprenez à configurer le chiffrement Web JSON (JWE) pour une API."
---

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Pour utiliser les fonctionnalités de l’identité très réglementée (HRI), vous devez disposer d’un plan Enterprise avec le module complémentaire Identité très réglementée. Consultez [Tarification Auth0](https://auth0.com/pricing/) pour plus de détails.

</Callout>

Par défaut, Auth0 émet des jetons d’accès formatés en tant que [Jeton Web JSON (JWT)](/docs/fr-ca/secure/tokens/json-web-tokens) signé, ce qui signifie qu’ils sont protégés contre les menaces d’intégrité, mais que les clients et autres intermédiaires peuvent toujours les inspecter. Cela peut entraîner une perte de confidentialité des informations sur les données destinées uniquement à être exposées à un serveur de ressources.

Pour empêcher l’inspection non autorisée des jetons d’accès, Auth0 prend en charge l’utilisation de jetons d’accès <Tooltip href="/docs/fr-ca/glossary?term=json-web-token" tip="Jeton Web JSON (JWT)
Format standard de jeton d’ID (et souvent de jeton d’accès) utilisé pour représenter en toute sécurité des demandes entre deux parties." cta="Voir le glossaire">JWT</Tooltip> imbriqués, où les informations d’accès sont signées dans un JWT puis chiffrées et représentées avec le chiffrement Web JSON (JWE). Les serveurs de ressources sont censés déchiffrer ces jetons d’accès et vérifier la signature de la charge utile JWT pendant que l’information est opaque pour toute autre partie.

## Générer une paire de clés RSA

Avant de configurer une API pour utiliser JWE, vous devez [générer une paire de clés RSA](/docs/fr-ca/secure/application-credentials/generate-rsa-key-pair).

La clé privée doit rester secrète. Télécharger la clé publique dans Auth0, encodée au format PEM, comme décrit dans [générer une paire de clés RSA](/docs/fr-ca/secure/application-credentials/generate-rsa-key-pair). Seul le serveur de ressources ou le serveur API peut accéder en toute sécurité à la clé privée pour déchiffrer le jeton d’accès.

## Configurer JWE pour une API

<Tabs><Tab title="Auth0 Dashboard">

Utilisez [Auth0 Dashboard](https://manage.auth0.com/) pour configurer JWE pour votre API. Pour commencer, activez **l’option du chiffrement Web JSON (JWE)** sous les **paramètres de jeton** pour votre API

<Frame>![](/docs/images/fr-ca/cdy7uua7fh8z/5xHKQ3rKN7DZogzD5qFDLp/623f3ab27591e30c96405869941f1e75/Access_Token_Settings_-_French.png)</Frame>

Lorsque vous y êtes invité, ajoutez une clé de chiffrement Web JSON (JWE) :

* Entrez un nom facile à retenir pour simplifier l’identification.
* Téléversez un certificat avec la clé publique chiffrée en format PEM.
* Sélectionnez l’algorithme de chiffrement.
* (Facultatif) Entrez un identifiant de clé.

Cliquez sur **Add (Ajouter)** pour enregistrer la clé JWE, ce qui générera un schéma du certificat.

</Tab><Tab title="Management API">

Utilisez la [Management API d’Auth0](https://auth0.com/docs/api/management/v2) pour configurer JWE pour un serveur de ressources ou un serveur API. Vous devez configurer JWE pour chaque API, de sorte que chaque API dispose de sa propre clé de chiffrement publique.

La requête POST suivante configure une nouvelle API pour qu’elle reçoive les jetons d’accès chiffrés :

```json lines
curl -X POST --location "https://{domain}/api/v2/resource-servers" \
    -H "Authorization: Bearer {managementAccessToken}" \
    -H "Content-Type: application/json" \
    --data-raw '{
  "name": "{apiName}",
  "identifier": "{apiIdentifier}",
  "token_encryption": {
    "format": "compact-nested-jwe",
    "encryption_key":
    {
      "name": "{credentialName}",
      "pem": "{pem}",
      "alg": "{alg}",
      "kid": "{kid}"
    }
  }
}'
```

Le tableau suivant explique ce que signifient les différents paramètres :

<table class="table"><thead>
<tr>
<th><strong>Paramètre</strong></th>
<th><strong>Obligatoire?</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>`apiName`</td>
<td>Obligatoire</td>
<td>Le nom de votre nouvelle API.</td>
</tr>
<tr>
<td>`apiIdentifier`</td>
<td>Obligatoire</td>
<td>L’identifiant unique de votre API. Il sera utilisé comme audience de jetons.</td>
</tr>
<tr>
<td>`credentialName`</td>
<td>Facultatif</td>
<td>Le nom de votre clé publique.</td>
</tr>
<tr>
<td>`pem`</td>
<td>Obligatoire</td>
<td>Clé publique encodée au format PEM.</td>
</tr>
<tr>
<td>`alg`</td>
<td>Obligatoire</td>
<td>L’algorithme de chiffrement doit être `RSA-OAEP-256`, `RSA-OAEP-384`, ou `RSA-OAEP-512`.</td>
</tr>
<tr>
<td>`kid`</td>
<td>Facultatif</td>
<td>L’identifiant utilisé pour écrire dans l’en-tête `kid` de votre jeton JWE. Il peut être utilisé pour identifier la clé utilisée pour le chiffrement pendant la rotation des clés.</td>
</tr>
</tbody>
</table>

La réponse contient la propriété `id` qui identifie de manière unique le serveur de ressources. La réponse contient également un champ `thumbprint_sha256` généré qui peut être utilisé pour identifier l’identifiant. Auth0 ne renverra pas de matériel de clé après la création initiale (dans ce cas, votre PEM).

Il existe de nombreuses façons de générer le champ `thumbprint_sha256`. Pour plus d’informations, consultez [Authentification du client mutuel-TLS RFC 8705 OAuth 2.0 et Jetons d’accès liés au certificat](https://datatracker.ietf.org/doc/html/rfc8705#name-jwt-certificate-thumbprint-).

Pour vous assurer d’avoir généré le bon champ `thumbprint_sha256`, vous pouvez utiliser l’exemple de code Node.js pour extraire l’empreinte numérique :

```javascript lines
const fs = require('fs');
const crypto = require('crypto');

const { calculateJwkThumbprint, exportJWK } = require('jose');

const publicKeyObject = crypto.createPublicKey(fs.readFileSync('./my_cert.pem'));
exportJWK(publicKeyObject).then((jwk) => {
  calculateJwkThumbprint(jwk, 'sha256').then((thumbprint) => {
    console.log(thumbprint);
  });
});
```

</Tab></Tabs>

## En savoir plus

* [Chiffrement Web JSON (JWE)](/docs/fr-ca/secure/tokens/access-tokens/json-web-encryption)