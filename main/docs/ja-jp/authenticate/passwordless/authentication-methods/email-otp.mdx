---
title: "メールでのパスワードレス認証"
permalink: "email-otp"
'description': "メール認証要素を使用してパスワードレス接続を使用する方法を説明します。"
'og:title': "メールでのパスワードレス認証"
'og:description': "メール認証要素を使用してパスワードレス接続を使用する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "メールでのパスワードレス認証"
'twitter:description': "メール認証要素を使用してパスワードレス接続を使用する方法を説明します。"
---

パスワードレス接続を構成して、ワンタイムパスワード（OTP）をメールでユーザーに送信し、認証を完了することができます。

詳細については、「[パスワードレス認証にメールまたはSMSを構成する](/docs/ja-jp/authenticate/login/auth0-universal-login/passwordless-login/email-or-sms)」をお読みください。

## 仕組み

新しいユーザーがOTPを受け取って初めてWebサイトで入力すると、Auth0によって認証される前に、`email`接続でユーザープロファイルが作成されます。

OTPが送信されたメールアドレスが既存のユーザーと一致する場合、Auth0はユーザーを認証します。

### 埋め込みログイン

<Frame>![埋め込みログインでパスワードレスにメールを使用したワークフローの図](/docs/images/ja-jp/cdy7uua7fh8z/3HMLxPTq9eCsq1eR21s0bL/fa25c9582c85c6302b79d21b369c79cf/SMS_Email_Flow.png)</Frame>

### ユニバーサルログイン

<Frame>![ユニバーサルログインでパスワードレスにメールを使用したワークフローの図](/docs/images/ja-jp/cdy7uua7fh8z/5p3cKrJwmc7MxpQ7pbXsjC/b3b6062b6c92f51889843cbc4edf515f/Screenshot_2024-10-29_at_11.54.03.png)</Frame>

## 接続を構成する

1. [Auth0 Dashboard>Authentication>Passwordless](https://manage.auth0.com/#/connections/passwordless)へ移動し、 **［Email（メール）］** トグルを有効化します。
2. **［Email（メール）］** を選択して構成ウィンドウを開き、 **［Settings（設定）］** ビューに切り替えて、電子メールの **［From（送信者）］** 、 **［Subject（件名）］** 、 **［Message（メッセージ）］** を入力します。

   <Callout icon="file-lines" color="#0EA5E9" iconType="regular">

   Auth0でカスタムのメールテンプレートを送信するには、 **From** （送信者）の値を「`auth0.com` 」が含まれないメールアドレスに変更しなければなりません。メールアドレスを変更しなかった場合、Auth0はデフォルトのメールテンプレートを送信します。

   </Callout>

3. **［OTP Expiry（OTPの有効期限）］** および **［OTP Length（OTPの長さ）］** を構築します。

   * 最後に発行されたOTP（またはリンク）のみが受け入れられます。最新のものが発行されると、他のものは無効になります。一度使用すると最新のものも無効になります。
   * OTPの入力の失敗は3回まで許可されます。この後は、新しいコードを要求する必要があります。
   * 発行されたOTPは、期限が切れるまで3分間有効です（デフォルト）。
   * OTPの有効期限を延長する場合は、OTPの長さも延長する必要があります。そうしないと、攻撃者が短いコードを推測しようとする時間が長くなってしまいます。
4. **［Disable Sign Ups（サインアップを無効にする）］** かどうかを決定します。この設定を有効にすると、既存のユーザーに対してのみパスワードレスのアクセスを許可できますが、アプリケーションがユーザー列挙攻撃の脅威にさらされる可能性があります。詳しくは、[パスワードレス接続のベストプラクティス](/docs/ja-jp/authenticate/passwordless/best-practices)をお読みください。
5. **［Save（保存）］** を選択します。

### 多言語サポート

**［Message（メッセージ）］** 領域は複数の言語をサポートしています。

言語を指定するには、[Auth0認証APIのGet CodeまたはLinkエンドポイント](https://auth0.com/docs/api/authentication#get-code-or-link)を呼び出して、`x-request-language`ヘッダーの値を設定します。このヘッダーが設定されていない場合、言語はブラウザによって自動的に設定される`accept-language`ヘッダーから抽出されます。

### メッセージの構文

**［Message（メッセージ）］** 領域はLiquid構文を受け入れます。この構文をパラメータ値と組み合わせて使用​​することで、メッセージの要素をプログラムで構築できます。

たとえば、`request_language`パラメータを参照してメッセージの言語を変更できます：

```liquid lines
{% if request_language contains 'dutch' %}
   Hier is uw verificatie code: {{ code }}
{% endif %}
{% if request_language contains 'fr-FR' %}
   Ceci est votre code: {{ code }}
{% endif %}
```

メッセージテンプレートを定義するときに使用できるパラメータは次のとおりです：

<table class="table"><thead>
<tr>
<th><b>パラメーター</b></th>
<th><b>説明</b></th>
</tr>
</thead>
<tbody>
<tr>
<td>`code`</td>
<td>使用するパスワード。</td>
</tr>
<tr>
<td>`link`</td>
<td>生成されるサインインリンク。</td>
</tr>
<tr>
<td>`application.name`</td>
<td>ユーザーがサインアップしているアプリケーションの名前。</td>
</tr>
<tr>
<td>`request_language`</td>
<td>メッセージコンテンツに対して要求された言語。</td>
</tr>
<tr>
<td>`operation`</td>
<td>APIを介してユーザーのメール更新によってテンプレートがトリガーされたかを示します。トリガーされると値は`change_email`になります。トリガーされていない場合は`null`です。</td>
</tr>
</tbody>
</table>

ユーザーが[組織](/docs/ja-jp/manage-users/organizations/organizations-overview)を通じてログインしている場合は、次のパラメータも利用できます：

* `organization.id`
* `organization.display_name`
* `organization.name`
* `organization.metadata`
* `organization.branding.logo_url`
* `organization.branding.colors.primary`
* `organization.branding.colors.page_background`

これらのパラメータとその値の詳細については、Auth0 <Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/docs/ja-jp/glossary?term=management-api" tip="Management API: 顧客が管理タスクを実行できるようにするための製品。" cta="用語集の表示">Management API</Tooltip>[組織エンドポイントの取得](https://auth0.com/docs/api/management/v2#!/Organizations/get_organizations_by_id)を参照してください。

## アプリケーションの有効化

**［Applications（アプリケーション）］** ビューに切り替えて、パスワードレスメールを使用するアプリケーションを有効にします。

## メールプロバイダー

Auth0は、デフォルトで独自のSMTPプロバイダーからメールを送信します。Auth0の組み込みメールプロバイダーはテスト目的のみに設計されており、メールテンプレートのカスタマイズはサポートされていません。

[独自のSMTPメールプロバイダーを構成](/docs/ja-jp/customize/email/smtp-email-providers)して、メール通信を管理、監視、トラブルシューティングし、メールテンプレートをカスタマイズします。

Auth0は次のメールプロバイダーをサポートします：

* [Mandrill](/docs/ja-jp/customize/email/smtp-email-providers/configure-mandrill-as-external-smtp-email-provider)
* [Amazon SES](/docs/ja-jp/customize/email/smtp-email-providers/configure-amazon-ses-as-external-smtp-email-provider)
* [Azure Communication Services](/docs/ja-jp/customize/email/smtp-email-providers/configure-azure-comm-service-as-smtp-email-provider)
* [SendGrid](/docs/ja-jp/customize/email/smtp-email-providers/configure-sendgrid-as-external-smtp-email-provider)
* [SparkPost](/docs/ja-jp/customize/email/smtp-email-providers/configure-sparkpost-as-external-smtp-email-provider)
* [Mailgun](/docs/ja-jp/customize/email/smtp-email-providers/configure-mailgun-as-external-smtp-email-provider)
* [カスタマイズされたSMTP外部メールプロバイダー](/docs/ja-jp/customize/email/smtp-email-providers/configure-custom-external-smtp-email-provider)