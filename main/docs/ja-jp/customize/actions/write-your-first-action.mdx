---
title: "初めてのActionを作成する"
permalink: "write-your-first-action"
'description': "フローの選択、アクションの作成と構成、フローへの導入など、アクションを作成する方法について説明します。"
'og:title': "初めてのActionを作成する"
'og:description': "フローの選択、アクションの作成と構成、フローへの導入など、アクションを作成する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "初めてのActionを作成する"
'twitter:description': "フローの選択、アクションの作成と構成、フローへの導入など、アクションを作成する方法について説明します。"
---

このガイドでは、<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/docs/ja-jp/glossary?term=auth0-dashboard" tip="Auth0 Dashboard: サービスを構成するためのAuth0の主製品。" cta="用語集の表示">Auth0 Dashboard</Tooltip>で初めてアクションを作成して導入する方法を手順を追って説明します。基本的な機能性を理解してすべてのアクションで活用し、プログラミングモデルにも慣れて使いこなせるようになりましょう。ここで身につける知識は、目的やフローにかかわらず、どのアクションの作成でも基礎となるものです。

## 目標：ユーザーのログインをSlackで通知する

ユーザーがログインしたときにSlackチャンネルにメッセージを送信するアクションを作成してみましょう。このチュートリアルではPost Loginトリガーを使用しますが、ここで提供する情報はどの種類のトリガーでも役に立ちます。

このタスクを遂行するには、以下の作業が必要です。

* [アクションを作成する](#create-an-action)
* [シークレットを追加する](#add-a-secret)
* [依存性を追加する](#add-a-dependency)
* [下書きを保存する](#save-the-draft)
* [カスタムロジックを追加する](#add-custom-logic)
* [アクションをテストする](#test-an-action)
* [アクションをデプロイする](#deploy-the-action)
* [アクションをフローにアタッチする](#attach-the-action-to-a-flow)
* [アクションの結果をテナントログで確認する](#observe-actions-in-tenant-logs)

## 前提条件

このアクションによってメッセージがSlackチャンネルに送信されるため、[Slack WorkspaceのIncoming Webhookを作成する](https://api.slack.com/messaging/webhooks)必要があります。Slack Webhook URLを作成してから、このガイドの手順に戻ってください。

## アクションを作成する

特定のフローでアクションを機能させるには、アクションを作成してフローに追加する必要があります。

1. [［Auth0 Dashboard］>［Actions（アクション）］>［Library（ライブラリ）］](https://manage.auth0.com/#/actions/library)の順に進み、 **［Create Action（アクションの作成）］** > **［Build from scratch（一から作成する）］** を選択します。
2. **名前** を入力し、ログインフローにアクションを追加するために **Login / Post Login** トリガーを選択し、 **［Create（作成）］** を入力します。

Actionsコードエディターが表示されます。

<Frame>![Actionsコードエディター](/docs/images/ja-jp/cdy7uua7fh8z/12Q8OEuDI39eWuWsrVVwN0/e3fca9bb81aeffc42fefc85b7ae25df5/2025-02-28_13-28-03.png)</Frame>

## テンプレートからアクションを作成する

Actionsテンプレートギャラリーには、アクションの作成に役立つ多種多様なスターターテンプレートを取り揃えています。テンプレートからアクションを作成するには、以下の手順で行います。

1. [［Auth0 Dashboard］>［Actions（アクション）］>［Library（ライブラリ）］](https://manage.auth0.com/#/actions/library)の順に進み、 **［Create Action（アクションの作成）］** を選択します。
2. **［Choose from template（テンプレートから選択）］** を選択します。
3. アクションを作成するのに使用したいテンプレートを選びます。
4. テンプレートにあるコードが読み取り専用のプレビューで表示されます。続行するには、 **［Use this template（このテンプレートを使用）］** を選択します。
5. 名前を入力してから、 **［Create（作成）］** を選択します。

## シークレットを追加する

アクションにはそれぞれシークレット値を含めることができ、アクセストークンやAPIキーなどの機密情報を保管するのに適しています。Slack Webhook URLをシークレットとして書き込んでみましょう。

1. Code Editorの左サイドバーにある鍵アイコンを選択します。
2. **［Add Secret（シークレットの追加）］** を選択します。
3. シークレットの名前に「`SLACK_WEBHOOK_URL`」を指定します。
4. Slackが提供するWebhook URLを貼り付けて、 **［Create（作成）］** を選択します。

シークレットがアクションに追加されました。新しいシークレットは、インテリジェントなコード補完機能に「`event.secrets`」と入力して使用することができます。

<Frame>![Actionsコードエディター - シークレットをシークレットセクションに追加](/docs/images/ja-jp/cdy7uua7fh8z/4FyFtKRSIYuigxE9U8TkEJ/2bb77cd8e4f43fc113f16d473cb6571f/Slack_action_-_secrets.png)</Frame>

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

いったんシークレットを作成すると、その値が公開されることは決してありません。Auth0は、すべてのシークレットを暗号化して安全に保管します。

</Callout>

## 依存性を追加する

[`@slack/webhook``npm`パッケージ](https://www.npmjs.com/package/@slack/webhook)を使用すると、メッセージをSlackに簡単に送信できます。[ネイティブなアドオン](https://www.npmjs.com/package/node-gyp)を使用せずにインストールできるのであれば、アクション内の`npm`パッケージのほぼどれでも使用することができます。

依存関係を追加するには、以下を行います。

1. サイドバーにある依存関係アイコン（立方体のアイコン）を選択します。
2. **［Name（名前）］** に「`@slack/webhook`」と入力します。

   デフォルトで、アクションは、依存関係が追加された時点で最新版の依存関係を使用します。
3. **［Create（作成）］** を選択すると、依存関係がアクションに追加されます。

   <Frame>![Actionsコードエディター：依存関係の追加完了](/docs/images/ja-jp/cdy7uua7fh8z/Jmzvgydo204pBLikzuDJy/1a9da30ecd50f2d5b67a44edeb1db6ea/Slack_action_-_Dependencies.png)</Frame>

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

このアクションを保存すると、最新バージョンの依存関係が解決され、特定のバージョン番号で置き換えられます。それにより、今後パッケージが更新されてもアクションが壊れることがありません。

</Callout>

## 下書きを保存する

**［Save Draft（下書きの保存）］** を選択します。アクションは保存されますが、フローの一環としてはまだ実行されません。Actionsを使用すると、Auth0テナントでトラフィックに影響を与えることなく、アクションを作成し、編集してテストすることができます。アクションの動作が思い通りになったら、アクションをデプロイして、後でフローに追加します。

## カスタムロジックを追加する

アクションにシークレットと依存関係を構成し終わったので、次はコードを書いてみましょう！

それぞれのアクションにはイベントオブジェクトがあり、アクションのトリガーに関する読み取り専用のコンテキスト情報が含まれています。エディターに「`event.`」と入力し始めると、イベントのプロパティとして使用可能なものがすべて表示されます。それぞれのトリガーに使用可能な情報については、「[フローをトリガーを調べる](/docs/ja-jp/customize/actions/explore-triggers)」をお読みください。

アクションを使って早速Slackに通知してみましょう！アクションに以下のコードを追加します。

```javascript lines
const { IncomingWebhook } = require('@slack/webhook');

exports.onExecutePostLogin = async (event, api) => {
    const url = event.secrets.SLACK_WEBHOOK_URL;
    const webhook = new IncomingWebhook(url);

    // Send the notification
    await webhook.send({ text: "Logging In..." });
};
```

**［Save Draft（下書きの保存）］** を選択し、アクションを保存します。

## アクションをテストする

実際のトラフィックを使ってテナントでアクションを実行する前にテストして、期待通りに動作することを確認します。

1. サイドバーにあるテストアイコン（三角形のアイコン）を選択します。ペイロードセクションには、アクションの作成時に選んだトリガーについて、編集可能なJSONデータが表示されます。

   <Frame>![Actionsコードエディター：テストランナーパネル](/docs/images/ja-jp/cdy7uua7fh8z/4MSu8EfpMLNJpcYtrwP7Jf/cc7c92a20b98c6e8ee2f80094e32ce29/2025-01-28_15-43-25.png)</Frame>

2. **［Run（実行）］** ボタンを選択すると、Slackチャンネルにメッセージが表示されるはずです。

## アクションをデプロイする

アクションが期待通りに動作していることが確認できたら、いよいよデプロイです。

**［Deploy（導入）］** を選択します。アクションをデプロイすると、その時点でのアクションのスナップショットが作成され、 **［Action Version（アクションのバージョン）］** として記録されます。

**［Version History（バージョン履歴）］** を選択すると、アクションが「Version 1」として記録されているのが分かります。

<Frame>![Actions：Version History（バージョン履歴）](/docs/images/ja-jp/cdy7uua7fh8z/53sn70cXoxUHibc3Bmk7Og/9a895dae68d07b3001c6d7da4577536d/2025-01-29_12-39-06.png)</Frame>

これで、「Version 1」のアクションに影響を与えることなく、アクションを自由に更新して保存することができます。Auth0は現在デプロイされているバージョンのアクションを実行するため、アクションがもう一度デプロイされるまでは「Version 1」のアクションが実行されます。

## アクションをフローにアタッチする

新しいアクションを構成する最後の手順は、フローにアタッチすることです。これを行うと、アクションがテナントのトラフィックの一部として実行されるようになります。

1. [［Auth0 Dashboard］>［Actions］>［Flows（フロー）］](https://manage.auth0.com/#/actions/flows)の順に進むと、使用できるフローの一覧が表示されます。
2. [［Login flow（ログインフロー）］](/docs/ja-jp/customize/actions/explore-triggers/signup-and-login-triggers/login-trigger)を選択し、`my-slack-action`をフローにドラッグします。

   <Frame>![アクションフロー：ログインフロー](/docs/images/ja-jp/cdy7uua7fh8z/6hU7sKWtGzSx9Z8dhsXbvp/4c0045990c36d185e996208b7465ccfe/Login_Action_-_JP.png)</Frame>

3. **［Apply（適用）］** を選択します。

これで、アクションがテナント内の実際のユーザートラフィックで実行されるようになりました。テスト環境をより強固にしたい場合には、[複数のAuth0環境をセットアップすることを](/docs/ja-jp/get-started/auth0-overview/create-tenants/set-up-multiple-environments)検討してください。

## テナントログでアクションを観察する

アクションがログインフローの一環として実行されるようになると、Auth0はアクションの各実行について情報をキャプチャしてテナントログに記録します。これを表示するには、[［Auth0 Dashboard］>［Auth0 Dashboard（モニタリング）］>［Logs（ログ）］](https://manage.auth0.com/#/logs)の順に進み、 **［Successful Login（正常なログイン）］** イベントを選択します。

**［Action Details（アクションの詳細）］** ビューに、フローで実行されたアクションについての情報が表示されます。

<Frame>![テナントログ：アクションの詳細ビュー](/docs/images/ja-jp/cdy7uua7fh8z/61k82wmsXSb9M3wOExM4jH/a4f045d106d8e7748e29d2c2318ea1cf/Action_-_success_login_log.png)</Frame>

## 次の手順

これで、初めてのアクションを作成できました。次に、「[フローとトリガーを調べる](/docs/ja-jp/customize/actions/explore-triggers)」を確認しながら、アクションを使って一般的なタスクを実行する方法を学習しましょう。