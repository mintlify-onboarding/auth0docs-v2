---
title: "アプリケーションサインアップのためのメール招待状を送信する"
permalink: "send-email-invitations-for-application-signup"
'description': "特定のAuth0アプリケーションのコンテキストで、サインアッププロセスをカスタマイズして、ユーザーにアカウントへのサインアップを招待する方法について説明します。"
'og:title': "アプリケーションサインアップのためのメール招待状を送信する"
'og:description': "特定のAuth0アプリケーションのコンテキストで、サインアッププロセスをカスタマイズして、ユーザーにアカウントへのサインアップを招待する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "アプリケーションサインアップのためのメール招待状を送信する"
'twitter:description': "特定のAuth0アプリケーションのコンテキストで、サインアッププロセスをカスタマイズして、ユーザーにアカウントへのサインアップを招待する方法について説明します。"
---

ユーザーのサインアップを制限したり、アプリケーションのアカウントを一括作成したりするために、アプリケーションはユーザーの招待を使用してユーザーをプロビジョニングできます。

<Warning>

Organizationメンバーの招待は、この記事にあるユーザー招待ワークフローとは異なります。この記事では、特定のアプリケーションのコンテキストでアカウントのサインアップへの招待を生成する方法について説明しています。Organizations機能でメールを使ってメンバーを組織に招待したい場合には、「[組織メンバーを招待する](/docs/ja-jp/manage-users/organizations/configure-organizations/invite-members)」をお読みください。

</Warning>

一般的なユーザーの招待ワークフローは以下の手順に従います。

1. 管理者はユーザーアカウントを作成します。
2. 管理者は登録メール招待状をユーザーに送信します。
3. ユーザーは招待状メールのリンクに従って、アカウントのパスワードをセットアップします。
4. ユーザーはパスワードを作成し、検証します。
5. ユーザーがサインインします。

## 招待状の作成

ユーザーの招待は基本的に、招待として再利用されたパスワード変更リンクです。ユーザー招待メールは、「パスワード変更」テンプレートから派生します。Auth0 では、ユーザーの招待を実装するための一般的なアプローチが2つあります。

* [メールテンプレートのカスタマイズ](/docs/ja-jp/customize/email/email-templates)と、それを使用した[パスワード変更メールの送信](/docs/ja-jp/customize/email/manage-email-flow)です。
* パスワード変更チケットを作成します。

ユーザーに代わって作成した既存のアカウントにユーザーがアクセスできるようにすることができます。次に、ユーザーにパスワードを設定するための固有のリンクを送信します。招待アプリが`/password-change`[Management APIエンドポイント](/docs/ja-jp/api/management/v2/#!/Tickets/post_password_change)を呼び出すパスワード変更チケットを作成することにより、一意のリンクを生成します。以下を行う必要があります。

* `user.email_verified`パラメーターを`false`に設定して[Auth0データベースユーザーを作成](/docs/ja-jp/authenticate/database-connections)します。[ユーザー作成](/docs/ja-jp/api/management/v2/#!/Users/post_users)エンドポイントを使用できます。
* [外部メールサービスにアクセスして構成する](/docs/ja-jp/customize/email/smtp-email-providers)
* [Management APIアクセストークンを取得する](/docs/ja-jp/secure/tokens/access-tokens/management-api-access-tokens/get-management-api-access-tokens-for-testing)

### パスワード変更チケットを作成する

1. [Management APIエンドポイント](https://auth0.com/docs/api/management/v2#!/Tickets/post_password_change)に`user_id`またはメールと`connection_id`を使用してユーザーを指定します。
2. リダイレクトによってユーザーを送信する場所を指定します。`result_url`パラメーターは、ユーザーがパスワードを設定した後にアプリケーションがユーザーに送信するリダイレクトの場所です。この場合、`result_url`はアプリのログインページでなければなりません。詳細については、「[ログイン後にユーザーをリダイレクトする](https://auth0.com/docs/authenticate/login/redirect-users-after-login)」をお読みください。以下に示す`client_id`パラメーターを使用することもできます。顧客がメールを確認すると、クライアントのデフォルトのログインURIにリダイレクトされます。
3. 招待リンクの有効期間を指定します。`ttl_sec`パラメーターを使用して、招待リンクがアクティブな期間を設定します。`ttl_sec`パラメーターは、関連するセキュリティ上の懸念事項に合わせて調整する必要があります。リンクは1回限りの使用であるため、ユーザーがパスワードを設定すると、再利用される危険性はありません。
4. メールアドレスを確認します。登録済みのメールアカウントに送信する場合は、`mark_email_as_verified`パラメーターを`true`に設定します。メールアカウントが登録されていない場合には、メール検証を`true`に設定 **しないでください** 。このエンドポイントの要求が成功すると、チケットURLを返します。このURLを使用してユーザーの招待を作成します。

詳細については、「[デフォルトのログインルートを構成する](/docs/ja-jp/authenticate/login/auth0-universal-login/configure-default-login-routes)」をお読みください。

```bash lines
curl -- request POST \
  --url 'https://{yourAuth0Tenant}/api/v2/tickets/password-change' \
  --header "Content-Type: application/json" \
  --data '{"user_id":,{yourUserID}","client_id":"{yourClientID","ttl_sec":0,"mark_email_as_verified":true,"includeEmailInRedirect":false}'
```

### クエリーパラメーターチケットURLを追加する

クエリーパラメーターをURLに追加して、パスワードリセットUIをカスタマイズできます。返されるURLには、ユーザーがパスワードとその後に続く`#`を設定できる一意のコード値が含まれます。`#`より前の部分は編集しないでください。

パラメーターを追加して、設定パスワードワークフローUIを指定します。例：

```http lines
#type=invite
```

パラメーターを追加してターゲットアプリを識別します。例：

```http lines
#app=AppName
```

### メールテンプレート作成する

メールの招待状は、既存のメールサービスプロバイダーを使用して送信する必要があります。[パスワード変更メールテンプレートをカスタマイズ](/docs/ja-jp/customize/email/email-templates)して、メール内の言語がユースケースに合うようにします。上記手順で生成されたリンクを含めます。メール内のテキストは次を説明します。

* ユーザーアカウントを要求する次の手順。
* リンクの有効期限。
* 有効期限が切れた場合の新しい招待を生成するための手順。

たとえば、招待するユーザーを作成するときに、このユーザーアカウントが招待されたことを示すプロパティを`user.app_metadata`に追加することができます。さらに、メールテンプレートでこのプロパティをチェックできます。

```liquid lines
{% if user.app_metadata.invitedToMyApp == true %}
  // user invitation email
{% else %}
  // password change email
{% endif %}
```

## パスワードリセットUIをカスタマイズする

ユーザーが招待内のリンクをクリックすると、ユニバーサルログインパスワードリセットページに移動し、アカウントのパスワードを設定できます。このページは、パスワードを忘れた場合のワークフローとユーザーの招待の両方に使用されるため、以前に定義したクエリパラメーターを使用して招待ワークフローを識別し、それに応じてUIをカスタマイズする必要があります。詳細については、「[パスワードリセットページをカスタマイズする](/docs/ja-jp/customize/login-pages/classic-login/customize-password-reset-page)」をお読みください。

## ユーザーエクスペリエンスを完了する

大半のケースにおいて、ユーザーがパスワードを設定すると、対象アプリへのアクセスを許可します。ターゲットアプリは次の手順でログインシーケンスを開始します。

1. ユーザーはパスワードを送信します。
2. パスワード変更画面がリダイレクトされ、URLが返されます。
3. ターゲットアプリは`/authorize`にリダイレクトします。
4. ユーザー資格情報提出します。
5. ユーザーはアプリに認証されます。

ワークフローにはリダイレクトが含まれますが、パスワード設定フォームからログインフォームへの移行がエンドユーザーにとってシームレスに見える可能性があります。

クラシックログインを使用している場合、パスワード変更チケットの作成時に設定した`result_url`は、ユーザーがパスワードを作成した後にリダイレクトされる場所になります。この場合、ログインワークフローを開始できるように、URLをユーザーが招待されたサイトに配置する必要があります。ターゲットアプリは、`success`パラメーターを解析してエラーが発生していないことを確認してから、すぐにAuth0へのリダイレクトを開始してユーザーをログインさせる必要があります。

ユーザーエクスペリエンスを最適化するには、ターゲットアプリで`email`パラメータを解析し、それを`login_hint`パラメータとして認証要求に含めることができます。これにより、ログインフォームにユーザーのメールアドレスが事前に入力されます。

## もっと詳しく

* [メールテンプレートをカスタマイズする](/docs/ja-jp/customize/email/email-templates)
* [メールのハンドリングをカスタマイズする](/docs/ja-jp/customize/email/manage-email-flow)
* [外部SMTPメールプロバイダーを構成する](/docs/ja-jp/customize/email/smtp-email-providers)