---
title: "認可拡張機能の構成"
permalink: "configure-authorization-extension"
'description': "認可拡張機能を構成する方法について説明します。"
'og:title': "認可拡張機能の構成"
'og:description': "認可拡張機能を構成する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "認可拡張機能の構成"
'twitter:description': "認可拡張機能を構成する方法について説明します。"
---

<Callout icon="file-lines" color="#0EA5E9" iconType="regular">

Auth0では、ロールベースのアクセス制御（RBAC）を2つの方法で実装できます。これは、API独自の内部アクセス制御システムの代わりに使用することもできれば、両方を組み合わせて使用することもできます。

* [認可コア](/docs/ja-jp/manage-users/access-control/rbac)
* [認可拡張機能](/docs/ja-jp/customize/extensions/authorization-extension)

認可コアの機能セットは、認可拡張機能と同じ機能性を備え、性能と拡張性を向上させると同時に、認可拡張機能より柔軟なRBACシステムを提供します。

現時点では、どちらもRBACの主要な機能を実装し、APIに対して定義されるカスタムスコープをユーザーに権限として割り当てられたスコープに制限することが可能です。

</Callout>

拡張機能で認可ロジックを適用する前に、ログイントランザクション中の動作を構成する必要があります。構成設定は、実行時に実行される[ルール](/docs/ja-jp/customize/rules)にキャプチャされます。

## 前提条件

[認可拡張機能のインストール](/docs/ja-jp/customize/extensions/authorization-extension/migrate-to-authorization-extension-v2)

## 拡張機能を構成

1. [［Auth0 Dashboard］>［Extensions（拡張機能）］](https://manage.auth0.com/#/extensions)に移動し、 **［Auth0 Authorization（Auth0認可）］** を選択します。
2. **［Authorization Dashboard（認可ダッシュボード）］** の右上にある **［Configuration（設定）］** を選択します。

   <Frame>![Dashboard - Authorization Extension Dashboard - Configuration](/docs/images/ja-jp/cdy7uua7fh8z/r8Ic6OYMcVfXDvIKePLrb/ed9c75536d20c12149e8b8e62a8edc44/click-configuration.png)</Frame>

3. これにより、 **［Configuration（構成）］** ページの **［Rule Configuration（ルールの構成）］** セクションが表示されます。グループ、ロール、権限に関連する変更など、 **［Token Contents（トークンの内容）］** の下のセクションで行ったすべての変更は、この手順の完了時にエクスポートするルールに反映されます。

   <Frame>![Authorization Extension Configuration](/docs/images/ja-jp/cdy7uua7fh8z/4ydHJBdKGs4XVLnRst66A3/1f61ad2e087252c6c3aa10add13d99cd/configuration0auth.png)</Frame>

### ApiKey（Apiキー）

ルールは、ApiKeyを使用してAuthorization Extension API（認可拡張機能API）と通信し、ポリシーを取得します。ApiKeyはルール構成として保存され、ルールが公開されると自動的に作成されます。ApiKeyを回転するには、 **［Rotate（ローテーション）］** ボタンをクリックします。ApiKeyが回転すると、ルール構成が自動的に更新されます。

## 発行されたトークンに認可情報を追加

グループやロール、権限などの認可データを、Auth0発行の送信されるトークンに保管することができます。アプリケーションはトークンを検査してこの情報を利用し、ユーザーの現在の認可コンテキストに基づいて適切な処置を行うことができます。

送信トークンにグループ、ロール、および権限情報を追加するには、含めるオプションの横にあるスライダーを有効にします。

<Warning>

トークンに過度にデータを保管すると、パフォーマンスが低下するだけでなく、トークンが発行されなくなる可能性があります。必要なデータのみを保管するようにしてください。大量のユーザーデータをすぐに利用できるようにしたい場合は、トークンにデータを追加するのではなく、永続化を検討してください。

</Warning>

### IdPからの認可データのマージ

Active Directoryなど、使用しているIDプロバイダー（<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-2" href="/docs/ja-jp/glossary?term=idp" tip="IDプロバイダー（IdP）: デジタルIDを保存および管理するサービス。" cta="用語集の表示">IdP</Tooltip>）からグループ、ロール、または権限を受け取るユーザーがいる場合があります。これらの項目を認可拡張機能で定義されている項目とマージ（保持）する場合は、適切な **［Passthrough（パススルー）］** オプションを有効にしてください。有効にする適切なマージの横にあるスライダーを有効にします。

### ユーザープロファイルに認可情報を保存

認可コンテキストが大きい場合（たとえば、ユーザーが多くのグループに属している場合や、多くの権限が付与されている場合などです。）、認可コンテンツの一部をユーザーのプロファイルに保存すると便利な場合があります。これにより、トークンに保存する情報が少なくなり、パフォーマンス関連の問題やトークン発行の問題が発生する可能性が低くなります。 **［Persistence（永続化）］** は、グループ、ロール、および権限情報をユーザーのプロファイルに保存するプロセスです。

データはユーザーの`app_metadata`フィールドに保存され、ユーザーがログインした後、<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/docs/ja-jp/glossary?term=management-api" tip="Management API: 顧客が管理タスクを実行できるようにするための製品。" cta="用語集の表示">Management API</Tooltip>または[Dashboard](https://manage.auth0.com/#/users)を使用してこの情報を取得できます。

<Frame>![Authorization Extension - Configuration - Persistence](/docs/images/ja-jp/cdy7uua7fh8z/5kfgcLhwwZkQ2Oh5uxaGxF/de5cf05429d1d1730a0165f4c61ac629/persistence.png)</Frame>

## ルールの変更を保存

ルールを構成したら、 **［Publish Rule（ルールの公開）］** をクリックします。これにより、各ユーザーログイン後に実行されるテナントのルールが作成されます。

### ルールを表示

作成したルールを表示する場合は、[［Auth0 Dashboard］>［Auth Pipeline（Authパイプライン）>［Rules（ルール）］](https://manage.auth0.com/#/rules)で確認できます。

ルールを開くと、正確なルール構成を確認できます。

## もっと詳しく

* [認可拡張機能のデータをインポートまたはエクスポートする](/docs/ja-jp/customize/extensions/authorization-extension/import-and-export-authorization-extension-data)
* [認可拡張機能へのAPIアクセスの有効化](/docs/ja-jp/customize/extensions/authorization-extension/enable-api-access-to-authorization-extension)
* [認可拡張でルールを使用する](/docs/ja-jp/customize/extensions/authorization-extension/use-rules-with-the-authorization-extension)
* [認可拡張機能ダッシュボードでユーザーをセットアップ](/docs/ja-jp/customize/extensions/authorization-extension/set-up-authorization-extension-users)
* [認可拡張機能のトラブルシューティング](/docs/ja-jp/troubleshoot/authentication-issues/troubleshoot-authorization-extension)
* [認可拡張機能v2に移行する](/docs/ja-jp/customize/extensions/authorization-extension/migrate-to-authorization-extension-v2)