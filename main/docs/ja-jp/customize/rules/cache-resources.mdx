---
title: "ルールで高コストなリソースをキャッシュする"
permalink: "cache-resources"
'description': "ルールのコードで高コストなリソースをキャッシュする方法。"
'og:title': "ルールで高コストなリソースをキャッシュする"
'og:description': "ルールのコードで高コストなリソースをキャッシュする方法。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "ルールで高コストなリソースをキャッシュする"
'twitter:description': "ルールのコードで高コストなリソースをキャッシュする方法。"
---

<Warning>

RulesとHooksのサポート終了（EOL）日は**2026年11月18日** であり、**2023年10月16** 日の時点で作成された新しいテナントは使用できなくなります。Hooksが有効な既存のテナントは、サポート終了までHooksを利用できます。

今後はActionsに移行して、Auth0の機能を拡張することを強くお勧めします。Actionsを使用すると、豊富な情報やインラインドキュメント、パブリック`npm`パッケージにアクセスして、外部統合を使って全体的な拡張エクスペリエンスを強化することができます。Actionsの詳細については、「[Auth0 Actionsの仕組みを理解する](/docs/ja-jp/customize/actions/actions-overview)」をお読みください。

当社では、移行の参考資料として、[RulesからActionsへの移行](/docs/ja-jp/customize/actions/migrate/migrate-from-rules-to-actions)と[HooksからActionsへの移行](/docs/ja-jp/customize/actions/migrate/migrate-from-hooks-to-actions)に関するガイドを提供しています。また、専用の「[Actionsへの移行](https://auth0.com/extensibility/movetoactions)」ページでは、機能の比較や[Actionsのデモ](https://www.youtube.com/watch?v=UesFSY1klrI)、その他のリソースを掲載して、円滑な移行をサポートしています。

RulesとHooksの廃止の詳細については、当社のブログ記事「[RulesとHooksの提供終了について](https://auth0.com/blog/preparing-for-rules-and-hooks-end-of-life/)」をお読みください。

</Warning>

ルールには、`global`オブジェクトを使用して高コストなリソースを保存することができます。`global`オブジェクトは個々の実行後も存続するため、ルールが実行される度に作成するのではなく、ルールに保存されているオブジェクトを再利用できます。ただし、ルールの環境はいつでも再利用される可能性があるので、コードでは常に、`global`に期待どおりの内容が含まれていることを確認する**必要があります** 。

この例では、`global`MongoDB接続を維持する方法を示しています。

```javascript lines
//If the db object is there, use it.
if (global.db){
  return query(global.db, callback);
}

//If not, get the db (mongodb in this case)
mongo('mongodb://user:pass@mymongoserver.com/my-db',  function (db){
  global.db = db;
  return query(db, callback);
});

//Do the actual work
function query(db, cb){
  // Do something with db
  ...
  return cb(null, user, context);
}
```

MongoDBの使用に関する詳細は、「[MongoDBマニュアル](https://docs.mongodb.com/manual/)」を参照してください。