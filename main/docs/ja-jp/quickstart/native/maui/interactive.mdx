---
title: "MAUIアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このチュートリアルは、Auth0を使用して、.NET MAUIアプリケーションにユーザーログインを追加する方法について説明します。"
'og:title': "MAUIアプリケーションにログインを追加する"
'og:description': "このチュートリアルは、Auth0を使用して、.NET MAUIアプリケーションにユーザーログインを追加する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/xamarin.png"
'twitter:title': "MAUIアプリケーションにログインを追加する"
'twitter:description': "このチュートリアルは、Auth0を使用して、.NET MAUIアプリケーションにユーザーログインを追加する方法について説明します。"
sidebarTitle: MAUI
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import MainpageXaml from "/snippets/quickstart/native/maui/MainPage.xaml.cs.mdx";
import MainpageXaml2 from "/snippets/quickstart/native/maui/MainPage.xaml.cs2.mdx";
import MainpageXaml3 from "/snippets/quickstart/native/maui/MainPage.xaml.cs3.mdx";
import MainpageXaml4 from "/snippets/quickstart/native/maui/MainPage.xaml.cs4.mdx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-sdkをインストールする", title: "Auth0 SDKをインストールする" },
  { id: "プラットフォーム特定の構成", title: "プラットフォーム特定の構成" },
  { id: "auth0clientをインスタンス化する", title: "Auth0Clientをインスタンス化する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" },
  { id: "ユーザープロファイル情報を表示する", title: "ユーザープロファイル情報を表示する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加することができます。このガイドは、.NET MAUIアプリケーションに[MAUI](https://www.nuget.org/packages/Auth0.OidcClient.MAUI/)用のAuth0 SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。

    <Info>
    MAUI SDKは、Android、iOS、macOS、Windowsに対応しています。プラットフォーム特有の構成に関しては、以下をお読みください。
    </Info>

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0 APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`myapp://callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`myapp://callback`に設定してください。
      </Info>
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      MAUIアプリケーションで、Auth0認証を手軽に実装できるように、Auth0は[MAUI](https://www.nuget.org/packages/Auth0.OidcClient.MAUI/)のSDKを提供しています。

      NuGetパッケージ マネージャー（［Tools（ツール）］ -> ［Library Package Manager（ライブラリーパッケージマネージャー）］ -> ［Package Manager Console（パッケージマネージャーコンソール）］）を使って`Auth0.OidcClient.MAUI`パッケージをインストールしてください。

      NuGetパッケージマネージャーコンソール（`Install-Package`）や`dotnet` CLI（`dotnet add`）を代わりに使用することもできます。

      ```
      Install-Package Auth0.OidcClient.MAUI
      ```

      ```
      dotnet add package Auth0.OidcClient.MAUI
      ```
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      SDKをAndroidとWindowsで使うためにはプラットフォーム特定の構成が必要です。

      ### Android

      `WebAuthenticatorCallbackActivity`を展開する新しいアクティビティを作成します：

      ```
      [Activity(NoHistory = true, LaunchMode = LaunchMode.SingleTop, Exported = true)]
      [IntentFilter(new[] { Intent.ActionView },
      Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
      DataScheme = CALLBACK_SCHEME)]
      public class WebAuthenticatorActivity : Microsoft.Maui.Authentication.WebAuthenticatorCallbackActivity
      {
      const string CALLBACK_SCHEME = "myapp";
      }
      ```

      上記のアクティビティは、ログイン後にAuth0がAndroidアプリケーションへリダイレクトで戻る時に、アプリケーションが`myapp://callback` URLをハンドリングできることを保証します。

      ### Windows

      Auth0にリダイレクトで戻された後、アプリケーションが適切に再アクティブ化されるには、2つのことを行う必要があります：

      - 対応するプロトコルを`Package.appxmanifest`に加えます。この場合、設定は`myapp`になっていますが、お好きなものに変更できます（関連するすべてのAuth0 URLも確実に更新してください）。

      ```html
      <Applications>
      <Application Id="App" Executable="$targetnametoken$.exe" EntryPoint="$targetentrypoint$">
      <Extensions>
      <uap:Extension Category="windows.protocol">
      <uap:Protocol Name="myapp"/>
      </uap:Extension>
      </Extensions>
      </Application>
      </Applications>
      ```

      - Windows固有の`App.xaml.cs`ファイルで`Activator.Default.CheckRedirectionActivation()`を呼び出します。

      ```
      public App()
      {
      if (Auth0.OidcClient.Platforms.Windows.Activator.Default.CheckRedirectionActivation())
      return;
      this.InitializeComponent();
      }
      ```
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Auth0をアプリケーションに統合するには、Auth0ドメイン、クライアントID、要求されたスコープを含む`Auth0ClientOptions`のインスタンスを渡して`Auth0Client`クラスをインスタンス化します。また、Auth0が構成したURLを使って確実にアプリケーションにリダイレクトするよう、`RedirectUri`と`PostLogoutRedirectUri`も構成する必要があります。

      ```
      using Auth0.OidcClient;
      var client = new Auth0Client(new Auth0ClientOptions {
      Domain = "{yourDomain}",
      ClientId = "{yourClientId}",
      RedirectUri = "myapp://callback",
      PostLogoutRedirectUri = "myapp://callback",
      Scope = "openid profile email"
      });
      ```

      SDKは初期設定で、AndroidにはChrome Custom Tabs、iOS・macOSにはASWebAuthenticationSessionを利用し、Windowsではシステムの既定ブラウザーが開きます。

      <Note>
      ##### チェックポイント
      Auth0Clientが適切にインスタンス化されました。アプリケーションを実行して次の点を確認します：
      Auth0ClientがMainPageで正しくインスタンス化されている。
      アプリケーションがAuth0に関連したエラーを投入していない。
      </Note>
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      Auth0アプリケーションとAuth0 SDKの構成が完了したら、プロジェクトのためにログインをセットアップする必要があります。これを実現するには、SDKの`LoginAsync()`メソッドを使用して、ユーザーをAuth0のユニバーサルログインページにリダイレクトするログインボタンを作成します。

      ```js
      var loginResult = await client.LoginAsync();
      ```

      エラーがなければ、`LoginAsync()`が返す`LoginResult`で`User`、`IdentityToken`、`AccessToken`、`RefreshToken`にアクセスすることができます。

      <Note>
      ##### チェックポイント
      ユーザー名とパスワードを使ってログインやサインアップができるようになりました。
      ログインボタンをクリックして次の点を確認します：
      アプリケーションによってAuth0ユニバーサルログインページにリダイレクトされる。
      ログインまたはサインアップできる。
      Auth0によってアプリケーションにリダイレクトされる。
      </Note>
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      プロジェクトにログインしたユーザーには、ログアウトする方法も必要です。SDKの`LogoutAsync()`メソッドを使用してログアウトボタンを作成します。ユーザーはログアウトすると、Auth0ログアウトエンドポイントにリダイレクトされてから、即座に、このクイックスタートで先ほどセットアップしたログアウトURLにリダイレクトで戻されます。

      ```
      await client.LogoutAsync();
      ```

      <Note>
      ##### チェックポイント
      アプリケーションを実行してログアウトボタンをクリックし、次の点を確認します：
      アプリケーションによって、アプリケーションの設定で［Allowed Logout URLs（許可されているログアウトURL）］の1つに指定されているアドレスへリダイレクトされる。
      アプリケーションにログインしていない。
      </Note>
      </Section>

      <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      ユーザーがログインやログアウトできるようになったら、認証済のユーザーに関連付けられた[プロファイル情報](/docs/ja-jp/users/concepts/overview-user-profile)を取得できるようにしたいと考えるはずです。たとえば、ログインしたユーザーの名前やプロフィール写真をプロジェクトに表示したいかもしれません。

      MAUI用のAuth0 SDKでは、`LoginResult.User`プロパティを通じてユーザー情報を提供します。
      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [auth0-oidc-client-net SDK](https://github.com/auth0/auth0-oidc-client-net) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <MainpageXaml />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <MainpageXaml2 />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <MainpageXaml3 />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[6].id}>
        <MainpageXaml4 />
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
