---
title: "PHPアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドは、PHPアプリケーションにAuth0 PHP SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。"
'og:title': "PHPアプリケーションにログインを追加する"
'og:description': "このガイドは、PHPアプリケーションにAuth0 PHP SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/php.png"
'twitter:title': "PHPアプリケーションにログインを追加する"
'twitter:description': "このガイドは、PHPアプリケーションにAuth0 PHP SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。"
sidebarTitle: PHP
mode: wide
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Index from "/snippets/quickstart/webapp/php/index.php.mdx";
import Login from "/snippets/quickstart/webapp/php/login.php.mdx";
import Logout from "/snippets/quickstart/webapp/php/logout.php.mdx";
import Profile from "/snippets/quickstart/webapp/php/profile.php.mdx";
import Router from "/snippets/quickstart/webapp/php/router.php.mdx";
import Callback from "/snippets/quickstart/webapp/php/callback.php.mdx";

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-php-sdkをインストールする", title: "Auth0 PHP SDKをインストールする" },
  { id: "ルートを作成する", title: "ルートを作成する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" },
  { id: "ユーザープロファイル情報を表示する", title: "ユーザープロファイル情報を表示する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加することができます。このガイドは、PHPアプリケーションにAuth0 PHP
        SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。

    このクイックスタートを使用するには、以下の手順に従います：

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadでセットアップしたアプリケーションが必要です。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      インタラクティブセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0の全てのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションに自動更新を行います。今後、アプリケーションの管理はDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000`に設定してください。
      </Info>

      ### Allowed Web Origins（許可されているWebオリジン）を構成する

      ［Allowed Web
            Origin（許可されているWebオリジン）］とは、認証フローにアクセスすることを許可して欲しいURLです。これにはプロジェクトのURLが含まれている必要があります。適切に設定されていない場合、プロジェクトが認証トークンを暗黙でリフレッシュできず、ユーザーがアプリケーションを再び訪問した時、またはページを再読み込みした時にログアウトした状態になってしまいます。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      PHPアプリで、Auth0の認証・認可を手軽に実装できるように、Auth0は[PHP SDK](https://github.com/auth0/auth0-PHP)（Auth0-PHP）を提供しています。

      Auth0 PHP SDKでは、ネットワーク要求を管理するために、[PSR-17](https://www.php-fig.org/psr/psr-17/)と[PSR-18](https://www.php-fig.org/psr/psr-18/)対応HTTPライブラリーをインストールする必要があります。ライブラリーがない場合は、ターミナルで以下のコマンドを実行して、信頼できる選択肢をインストールすることができます：

      ```text lines
      cd <your-project-directory>
      composer require symfony/http-client nyholm/psr7
      ```

      

      ターミナルで以下のコマンドを実行してAuth0 PHP SDKをインストールします：

      ```text lines
      composer require auth0/auth0-php
      ```

      

      ### Auth0 SDKを構成する

      アプリケーションで`index.php`と呼ばれる新しいファイルを作成し、**index.php** タブにある、右のインタラクティブパネルからコードをコピーします。

      SDKが正しく機能するためには、次のプロパティを初期化中にAuth0 SDKで設定しなければなりません：

      - `domain`：Auth0テナントのドメインです。通常、Auth0 Dashboardにあるアプリケーションの設定の［Domain（ドメイン）］フィールドで確認できます。[カスタムドメイン](/docs/ja-jp/custom-domains)を使用している場合は、その値を代わりに設定してください。
      - `clientId`：このクイックスタートで前にセットアップした、Auth0アプリケーションのIDです。Auth0
                Dashboardにあるアプリケーションの［Settings（設定）］の［Client ID（クライアントID）］フィールドで確認できます。
      - `clientSecret`：このクイックスタートで前にセットアップしたAuth0アプリケーションのシークレットです。Auth0
                Dashboardにあるアプリケーションの［Settings（設定）］の［Client Secret（クライアントシークレット）］フィールドで確認できます。
      - `redirectUri`：ユーザー認証の後、Auth0にユーザーをリダイレクトするアプリケーション内URLです。このクイックスタートで前にセットアップしたCallback
                URLと呼応します。Auth0 Dashboardにあるアプリケーションの設定の［Callback
                URLs（コールバックURL）］フィールドでもこの値を確認できます。コードに入力した値と前にセットアップした値は必ず一致させてください。異なった場合はユーザーにエラーが表示されます。
      - `cookieSecret`：セッションクッキーの暗号化に使用する長いシークレット値です。ターミナルで`openssl rand -hex 32`を実行すると、適切な文字列を生成することができます。

      <Note>
      ##### チェックポイント

      Auth0 SDKが正しく構成されました。アプリケーションを実行して次の点を確認します：

      - SDKが正しく初期化している。
      - アプリケーションがAuth0に関連したエラーを投入していない。
      </Note>
    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      次に、受信要求をアプリケーションにダイレクトするために、ルーティングライブラリーをインストールします。これは必須手順ではありませんが、本クイックスタートの目的上、アプリケーション構造が簡略化されます。

      ```text lines
      composer require steampixel/simple-php-router
      ```

      

      アプリケーションで`router.php`と呼ばれる新しいファイルを作成してルートを定義し、右のインタラクティブパネルからコードをコピーします。
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      Auth0アプリケーションとAuth0 PHP
            SDKの構成が完了したら、プロジェクトのためにログインをセットアップする必要があります。これを実現するには、SDKの`login()`メソッドを使用して、ユーザーをAuth0のユニバーサルログインページにリダイレクトするログインボタンを作成します。ユーザーが認証に成功すると、このクイックスタートで前にセットアップしたCallback
            URLへリダイレクトされます。

      アプリケーションで`login.php`という名前の新規ファイルを作成し、右のインタラクティブパネルからコードをコピーします。これにはログインに必要なロジックが含まれています。

      <Note>
      ##### チェックポイント

      ユーザー名とパスワードを使ってログインやサインアップができるようになりました。

      ログインリンクをクリックして次の点を確認します：

      - アプリケーションによってAuth0ユニバーサルログインページにリダイレクトされる。
      - ログインまたはサインアップできる。
      - Auth0が、SDKを構成するために使った`redirectUri`の値を使用し、アプリケーションへリダイレクトする。
      </Note>
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      プロジェクトにログインしたユーザーには、ログアウトする方法も必要です。SDKの`logout()`メソッドを使用してログアウトボタンを処理します。ユーザーはログアウトすると、[Auth0ログアウト](https://auth0.com/docs/api/authentication?http#logout)エンドポイントにリダイレクトされてから、即座に、このクイックスタートで先ほどセットアップしたログアウトURLへとリダイレクトで戻されます。

      アプリケーションで`logout.php`という名前の新規ファイルを作成し、インタラクティブパネルからコードをコピーします。これにはログアウトに必要なロジックが含まれています。それから`index.php`ファイルを更新して新しいログアウトボタンを含めます。

      <Note>
      ##### チェックポイント

      アプリケーションを実行してログアウトボタンをクリックし、次の点を確認します：

      - アプリケーションによって、アプリケーションの設定で［Allowed Logout URLs（許可されているログアウトURL）］の1つに指定されているアドレスへリダイレクトされる。
      - アプリケーションにもうログインしていない。
      </Note>
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      ユーザーがログインやログアウトできるようになったら、認証済のユーザーに関連付けられた[プロファイル情報](/docs/ja-jp/users/concepts/overview-user-profile)を取得できるようにしたいと考えるはずです。たとえば、ログインしたユーザーの名前やプロフィール写真をプロジェクトに表示したいかもしれません。

      Auth0 PHP
            SDKでは`getCredentials()`メソッドからユーザー情報が提供されます。インタラクティブパネルで`profile.php`コードを確認し、使用方法の例をチェックします。

      このメソッドにはユーザーのアイデンティティに関する機密情報が含まれるため、この方法が使用できるかはユーザーの認証ステータスによります。エラーを防ぐため、`getCredentials()`メソッドが`object`または`null`を返すかを必ず確認し、アプリケーションが結果を使用する前に、Auth0がユーザーを認証したかどうか判定します。

      <Note>
      ##### チェックポイント

      以下の点を確認します：

      - ログイン後、`nickname`やその他のユーザープロパティをすべて正しく表示できる。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Auth0-PHP SDK](https://github.com/auth0/auth0-php) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <AuthCodeGroup>
        <Index/>
        <Login/>
        <Logout/>
        <Profile/>
        <Router/>
        <Callback/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <AuthCodeGroup>
        <Router/>
        <Index/>
        <Login/>
        <Logout/>
        <Profile/>
        <Callback/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <AuthCodeGroup>
        <Login/>
        <Index/>
        <Logout/>
        <Profile/>
        <Router/>
        <Callback/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <AuthCodeGroup>
        <Logout/>
        <Index/>
        <Login/>
        <Profile/>
        <Router/>
        <Callback/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <AuthCodeGroup>
        <Profile/>
        <Index/>
        <Login/>
        <Logout/>
        <Router/>
        <Callback/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
