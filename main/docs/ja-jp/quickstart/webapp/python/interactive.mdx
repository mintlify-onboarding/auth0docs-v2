---
title: "Python Flaskアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このガイドでは、Python FlaskアプリケーションにAuthlib SDKを使ってAuth0を統合する方法を説明します。"
'og:title': "Python Flaskアプリケーションにログインを追加する"
'og:description': "このガイドでは、Python FlaskアプリケーションにAuthlib SDKを使ってAuth0を統合する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/python.png"
'twitter:title': "Python Flaskアプリケーションにログインを追加する"
'twitter:description': "このガイドでは、Python FlaskアプリケーションにAuthlib SDKを使ってAuth0を統合する方法を説明します。"
sidebarTitle: Python
mode: wide
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Server from "/snippets/quickstart/webapp/python/server.py.mdx";
import Home from "/snippets/quickstart/webapp/python/home.html.mdx";

import {AuthCodeGroup} from "/snippets/AuthCodeGroup.jsx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "依存関係をインストールする", title: "依存関係をインストールする" },
  { id: "envファイルを構成する", title: ".envファイルを構成する" },
  { id: "アプリケーションをセットアップする", title: "アプリケーションをセットアップする" },
  { id: "ルートをセットアップする", title: "ルートをセットアップする" },
  { id: "テンプレートを追加する", title: "テンプレートを追加する" },
  { id: "アプリケーションを実行する", title: "アプリケーションを実行する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに認証を追加して、ユーザープロファイル情報にアクセスすることができます。このガイドでは、Python [Flask](https://flask.palletsprojects.com/)アプリケーションに[Authlib](https://authlib.org/) SDKを使ってAuth0を統合する方法を説明します。

    <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadでセットアップしたアプリケーションが必要です。Auth0アプリケーションは、開発中のプロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使ってAuth0アプリケーションを新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0
            APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      代わりに完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000/callback`に設定してください。
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、`http://localhost:3000`に設定してください。
      </Info>
    </Section>

    <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      プロジェクトディレクトリに`requirements.txt`ファイルを作成します：

      ```txt lines
      # 📁 requirements.txt -----
      flask>=2.0.3
      python-dotenv>=0.19.2
      authlib>=1.0
      requests>=2.27.1
      ```

      シェルから以下のコマンドを実行し、プロジェクトで依存関係が利用できるようにします：

      ```bash lines
      pip install -r requirements.txt
      ```

    </Section>

    <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      次に、プロジェクトのディレクトリに`.env`ファイルを作成します。このファイルにはクライアントキーやその他の構成情報が含まれます。

      ```env lines
      # 📁 .env -----
      AUTH0_CLIENT_ID=mz9iNEIo2PHu7oeh8QRt19ndTyyCIgai
      AUTH0_CLIENT_SECRET=yLTW7npKO4g1HHsCENiZbOaHHXLmhVefJxdNnXcyhOBOomZ2tgjJjSC2pMK7Swvr
      AUTH0_DOMAIN=dev-gja8kxz4ndtex3rq.us.auth0.com
      APP_SECRET_KEY=
      ```

      - シェルから`openssl rand -hex 32`を使って、`APP_SECRET_KEY`の文字列を生成します。
    </Section>

    <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      次に、アプリケーションをセットアップします。プロジェクトディレクトリで`server.py`ファイルを作成します。このファイルにはアプリケーションロジックが含まれます。

      アプリケーションに必要なすべてのライブラリーをインポートします。

      前の手順で作成した構成`.env`ファイルを読み込みます。

      Auth0でアプリケーションの認証を処理するためにAuthlibを構成します。AuthlibのOAuth `register()`メソッドで使用できる構成オプションの詳細については、[Authlibのドキュメント](https://docs.authlib.org/en/latest/client/frameworks.html#using-oauth-2-0-to-log-in)
    </Section>

    <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      この例では、アプリケーションにlogin、callback、logout、homeの4つのルートを追加します。

      アプリ訪問者が`/login`ルートにアクセスすると、アプリケーションはユーザーをAuth0ログインページに遷移します。

      ユーザーがAuth0でログインした後、アプリケーションはユーザーを`/callback`ルートに遷移します。このルートはユーザーのためにセッションを保存し、戻ってきた時に再度ログインする必要性を回避します。

      `/logout`ルートは、ユーザーをアプリケーションからサインアウトさせます。アプリのユーザーセッションを消去し、Auth0ログアウトエンドポイントにリダイレクトして、セッションがもう保存されていないことを保証します。その後、アプリケーションはユーザーをホームルートにリダイレクトします。

      `/`ホームルートは認証されたユーザーの詳細を表示したり、訪問者のサインインを許可したりします。
    </Section>

    <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      次に、（`render_template()`の呼び出し中に）ホームルートで使用されるテンプレートファイルを作成します。

      `templates`という名前のプロジェクトフォルダーに新しいサブディレクトリを作成し、ディレクトリに`home.html`を作成します。コンテンツを右から対象ファイルに貼り付けます。
    </Section>

    <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      アプリケーションを実行するには、プロジェクトディレクトリのルートに移動し、ターミナルを開きます。次のコマンドを実行します：

      ```bash lines
      python3 server.py
      ```

      <Note>
      ##### チェックポイント

      検証するには[http://localhost:3000](http://localhost:3000/)を訪問します。ログインのためにAuth0へルートするログインボタンがあり、ログイン後アプリケーションに戻るとプロファイル情報を確認できます。
      </Note>
    </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [auth0-python SDK](https://github.com/auth0/auth0-python) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
    <SideMenuSectionItem id={sections[0].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[1].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[2].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[3].id}>
      <AuthCodeGroup>
        <Home/>
        <Server/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[4].id}>
      <AuthCodeGroup>
        <Server/>
        <Home/>
      </AuthCodeGroup>
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[5].id}>
      <SignUpForm />
    </SideMenuSectionItem>

    <SideMenuSectionItem id={sections[6].id}>
      <SignUpForm />
    </SideMenuSectionItem>

  </SideMenu>
</Recipe>
