---
title: "SAMLエラーのトラブルシューティング"
permalink: "saml-errors"
'description': "SAMLに関してよくあるエラーの問題を解決する方法について説明します。"
'og:title': "SAMLエラーのトラブルシューティング"
'og:description': "SAMLに関してよくあるエラーの問題を解決する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "SAMLエラーのトラブルシューティング"
'twitter:description': "SAMLに関してよくあるエラーの問題を解決する方法について説明します。"
---

## 無効な要求 - 接続が無効です

### 理由

このメッセージは、アプリケーションにアクティブな接続が関係付けられていないことを示しています。

### 解決策

1. [［Authentication（認証）］>［Enterprise（エンタープライズ）］](https://manage.auth0.com/#/connections/enterprise)に移動します。
2. **［SAML］** をクリックします。
3. 確認したい接続をクリックします。
4. **［Applications（アプリケーション）］** タブをクリックします。
5. 少なくとも1つのアプリケーションを有効にします（リストが空の場合には、処理を進める前に、[アプリケーションを作成する](/docs/ja-jp/get-started/applications)必要があります）。

## IdP起点のデフォルトアプリが構成されていません

### 理由

このエラーは、<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-2" href="/docs/ja-jp/glossary?term=idp" tip="IDプロバイダー（IdP）: デジタルIDを保存および管理するサービス。" cta="用語集の表示">IdP</Tooltip>起点のログインフローへの対応に必要な情報が提供されていない場合に表示されます。

### 解決策

1. [［Authentication（認証）］>［Enterprise（エンタープライズ）］](https://manage.auth0.com/#/connections/enterprise)に移動します。
2. **［SAML］** をクリックします。
3. 確認したい接続をクリックします。
4. **［IdP-Initiated SSO（IdP起点のSSO）］** タブに切り替えます。
5. **［Accept Requests（要求を許可する）］** を選択し、**［Default Application（デフォルトのアプリケーション）］** とそのアプリケーションが使用する **［Response Protocol（応答プロトコル）］** を選択してから、（任意で）アプリケーションに渡したい追加のパラメーターを指定します。
6. **［Save Changes（変更を保存）］** をクリックします。

<Card title="SP起点のログインのトラブルシューティング">

SP起点のフローでこのエラーが表示される場合、次のいずれかが欠けているか、空である可能性があります。

* `RelayState`パラメーター
* SAML応答にあるべき`InResponseTo`属性

これらが欠けている場合、Auth0はログインをIdP起点として扱います。エラーを解消するには、構成をチェックして、両方のフィールドが適切に入力されていることを確認してください。

</Card>

## RelayStateパラメーターがありません

### 理由

このエラーは、IDプロバイダーが応答で`RelayState`パラメーターを返さない場合に発生します。

### 解決策

IDプロバイダーに問い合わせて、`RelayState`パラメーターが必ず返されるようにしてください。

## オーディエンスが無効です

このエラーは、IDプロバイダーの<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-1" href="/docs/ja-jp/glossary?term=security-assertion-markup-language" tip="Security Assertion Markup Language（SAML）: パスワードなしに二者間で認証情報を交換できる標準化プロトコル。" cta="用語集の表示">SAML</Tooltip>応答にある`audience`値がAuth0で予期する値と一致しない場合に発生します。この値に、Auth0は接続のエンティティIDを期待します。

### 解決策

1. [［Authentication（認証）］>［Enterprise（エンタープライズ）］](https://manage.auth0.com/#/connections/enterprise)に移動します。
2. **［SAML］** をクリックします。
3. 確認したい接続をクリックします。
4. **［Setup（セットアップ）］** タブの **［Common Settings（共通設定）］** セクションにある2番目のパラメーターが **エンティティID** です。IDプロバイダーがSAML応答で正しい`audience`値を送信することを確認します。

## 不正なプロトコルが指定されました

**［IdP-Initiated（IdP起点）］** タブに不正な応答プロトコルがあります。この応答プロトコルは、Auth0とアプリケーション（リモートIDプロバイダーではない）の間で使用されます。たとえば、この値を **SAML** に設定して、アプリケーションが **<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/docs/ja-jp/glossary?term=openid" tip="OpenID: アプリケーションがログイン情報を収集および保存することなくにユーザーのIDを検証できるようにする認証用のオープン標準。" cta="用語集の表示">OpenID</Tooltip> Connect** または **<Tooltip data-tooltip-id="react-containers-DefinitionTooltip-2" href="/docs/ja-jp/glossary?term=ws-fed" tip="Webサービスフェデレーション（WS-Fed）: ドメイン全体でユーザーIDを管理するためのプロトコル。" cta="用語集の表示">WS-Fed</Tooltip>** を期待する場合には、不正な構成のためにエラーが発生します。

### 解決策

1. [［Authentication（認証）］>［Enterprise（エンタープライズ）］](https://manage.auth0.com/#/connections/enterprise)に移動します。
2. **［SAML］** をクリックします。
3. 確認したい接続をクリックします。
4. **［Settings（設定）］** タブの **［Response Protocol（応答プロトコル）］** フィールドに設定されている値を確認します。

## ユーザーがIdPからログアウトしていません

ADFSがSAML IdPとして構成されている場合、ADFSの証明書利用者信頼の`Name ID`属性がマッピングされていないと、ログアウトフローが失敗します。たとえば、フェデレーションパラメーターの`v2/logout?federated&...`では、ユーザーはADFS SAMLログアウトエンドポイントにリダイレクトされずに、アプリケーションのコールバックURLに直接リダイレクトで戻されます。この場合、結果的に、ユーザーはIdPからログアウトされません。

### 解決策

`Name ID`属性を［SAML Relaying Party Trust（証明書利用者信頼）］のルールとして追加します。

## IdP起点のSSOを使用したい場合には、［SAML Identity Provider（SAML IDプロバイダー）］に移動して、接続パラメーターを必ずポストバックURL（別称Assertion Consumer Service URL）[推奨されるCallback URL]に含めます。

`/login/callback`への要求でクエリ文字列に`connection=xxxx`が含まれていません。

### 解決策

クエリ文字列に`connection=xxxx`パラメーターを含めます。