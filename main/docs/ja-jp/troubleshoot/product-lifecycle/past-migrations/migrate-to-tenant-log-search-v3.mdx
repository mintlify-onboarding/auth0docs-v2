---
title: "テナントログ検索v3への移行"
permalink: "migrate-to-tenant-log-search-v3"
'description': "Auth0ログ検索v2からv3へ移行する方法を説明します。"
'og:title': "テナントログ検索v3への移行"
'og:description': "Auth0ログ検索v2からv3へ移行する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "テナントログ検索v3への移行"
'twitter:description': "Auth0ログ検索v2からv3へ移行する方法を説明します。"
---

最も信頼できるスケーラブルなソリューションをお客様に提供するために、Auth0は、v3を支持して、テナントログ検索エンジンv2を廃止しました。

Auth0は、この変更の影響を受けないお客様を積極的に移行しながら、影響を受ける可能性があるお客様に、猶予期間中にv3のオプトインを行うよう通知します。

## 影響のある機能

以下の基準を満たす場合は影響を受けます。

* 2019年5月21日以前に作成されたテナント。
* AUまたはEU地域にあるAuth0のパブリッククラウドでホストされているテナント。
* パラメーター`include_totals=true`または`q`パラメーターで、GET /api/v2/logsまたはGET `/api/v2/users/{user_id}/logs`エンドポイントを使用している場合。
* 1000より多い結果をページネーションしている場合。
* 委任管理拡張機能を使用している場合。この拡張の旧バージョンは、テナントがログ検索エンジンv3に移行された後も機能し続けますが、ログを表示すると、ページネーションの統計が正しくないことに気づくでしょう。拡張のv3.7に更新することで、この問題に対処できます。

次のテナントは影響を受けません。

* US地域のクラウドテナント。US地域は、完全に移行されており、すでに検索エンジンv3を使用しています。
* プライベートクラウドのテナント（プライベートクラウドのお客様の移行は、後日開始します）。
* EUおよびAU地域のクラウドテナントで、以下の場合：

  + Management APIの`GET /api/v2/logs`または`GET /api/v2/users/{user_id}/logs`エンドポイントをまったく使用していない。
  + Dashboard Logsセクションのログのみを消費している。
  + チェックポイントによるメソッドで（`from`パラメーターを使用して）`GET /api/v2/logs endpoint`を使用している。
  + 外部サービスのダッシュボード拡張（チェックポイントによるメソッドを使用する）へのAuth0ログのいずれかを使用して、ログを消費している場合。

## クエリ移行の確認

Auth0は、同じタイプと説明のログを1つだけ60分おきに生成します。廃止された機能を使用して影響を受けたエンドポイントを何回呼び出した場合でも、廃止された各機能に対し、1時間につき1つのログしか表示されません。

クエリに変更を加えた場合、新しい`depnote`ログがないことが、廃止された動作がコードから削除されたことを意味するのかを最終的に判断するには、60分待つ必要があります。

v3への移行後にエラーをスローするクエリを探すために、以下でテナントログを検索できます。

`type:depnote AND description:*logs*`

これらのログエントリーは、使用している廃止動作を特定する`description`を含みます。

また、`details.request.path`および`client_name`フィールドをチェックして、どのアプリケーションが`GET /api/v2/logs`か`GET /api/v2/users/{user_id}/logs`を呼び出しているか確認できます。

## 変更点

破壊的変更は少ないですが、結果が期待通りであることを確認するためにクエリを調べてください。

破壊的変更は、以下と関係しています。

### ページネーション

* テナントがログv3に移行されるとき、`GET /api/v2/logs`または`GET /api/v2/users/{user_id}/logs`を呼び出したときに要約結果で返される`total`フィールドの値は変更します。検索エンジンv2を使用してログを検索したとき、結果の合計フィールドは、提供したクエリに一致するログの数を伝えます。ただし、v3では、合計フィールドは、ページで返されたログの数を示します（フィールドが返す長さに似ている）。中断のリスクを避けるために、アプリケーションがページネーション目的で合計フィールドに依存する場合、この変更に適切に対応するためにロジックを更新する必要があります。
* 要求ごとに100ログという既存の制限があります。テナントがログv3に移行されると、最大1,000件の検索結果をページネーションでき、その結果1,000件を超える呼び出しはエラーを返します。中断のリスクを避けるために、この制限を回避する、またはそれに応じてエラーに対処するために、クエリを確認する必要があります。

### qパラメーターの検証

* クエリ構文は、`GET /api/v2/logs`で`q`パラメーターを使用した場合、考慮すべき若干の変更があります。テナントがログv3に移行されると、この検証が強制され、結果としてこのクエリがエラーを返します。中断のリスクを避けるために、クエリがサポートされているクエリ構文に従っていることを確認してください。
* `q`パラメーターは、無効なフィールドを含んでいます。テナントがログv3に移行されると、この検証が強制され、結果としてこの呼び出しがエラーを返します。中断のリスクを避けるために、検索可能なフィールドのみが含まれているかクエリを確認してください。

## テナントログ検索v3の有効化

クエリを確認したら、Dashboardを通してテナントログ検索エンジンv3をオプトインできます。

1. [［Tenant Settings（テナント設定）］>［Advanced（詳細設定）］](https://manage.auth0.com/#/tenant/advanced)に移動します。
2. **［Migrations（移行）］** までスクロールします。
3. **「Legacy Logs Search V2（旧式のログ検索V2）］** のトグルスイッチをオフに切り替えます。このスイッチをオフに切り替えると、廃止済みのログ検索エンジンv2を無効にし、検索エンジンｖ3の使用を強制します。**「Legacy Logs Search V2（旧式のログ検索V2）］** トグルが表示されない場合は、すでにv3に移行済みです。これ以上のアクションは必要ありません。

移行についてサポートが必要な場合は、[サポートセンター](https://support.auth0.com/)を介してご連絡ください。

## もっと詳しく

* [ログ](/docs/ja-jp/deploy-monitor/logs)