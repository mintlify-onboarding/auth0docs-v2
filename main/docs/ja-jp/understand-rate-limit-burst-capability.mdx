---
title: "レート制限のバースト機能を理解する"
permalink: "understand-rate-limit-burst-capability"
'description': "Auth0のバースト機能について説明し、レート制限の計算例を示します。"
'og:title': "レート制限のバースト機能を理解する"
'og:description': "Auth0のバースト機能について説明し、レート制限の計算例を示します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/img/share-image.png"
'twitter:title': "レート制限のバースト機能を理解する"
'twitter:description': "Auth0のバースト機能について説明し、レート制限の計算例を示します。"
---

**発効日** ：2021年11月10日

Auth0は、APIのレート制限とバースト制限を維持します。レート制限は、システムが処理する持続可能な最大のトラフィック量で、バースト制限は、1つの時間間隔においてシステムが処理する短期的な最大のトラフィック量です。Auth0のレート制限とバースト制限は連携し、動的なトラフィック量に対して効果的な制限機能を提供します。

Auth0のレート制限にはルールを介した呼び出しが含まれ、エンドポイントではなく、テナント別に設定されます。

## バースト制限

上述のように、バースト制限は、1つの時間間隔においてシステムが処理する短期的な最大のトラフィック量です。Auth0の各エンドポイントには、要求の制限とレート制限の時間枠（秒単位、分単位、日単位など）を定義する「バケット」が設定されています。サンプルエンドポイントのバケット設定例を見てみましょう。

``` lines
bucket:
    size: x
    per_minute: y
```

このサンプルでは、あるバケットの要求の制限が最大 `x` （分単位）で設定されています。1分経過するたびに、`y` 件の要求のアクセス許可が追加されます。言い換えると、**60/y** 秒ごとに、バケットにさらにもう1つの要求が追加されるわけです。バケットに含まれる要求が最大許容数（**x**）に達するまで、この処理は自動的に行われます。

## 実際のユースケース

サンプルエンドポイントの「バケット」が設定されていることに留意し、Auth0 <Tooltip data-tooltip-id="react-containers-DefinitionTooltip-0" href="/docs/ja-jp/glossary?term=management-api" tip="Management API: 顧客が管理タスクを実行できるようにするための製品。" cta="用語集の表示">Management API</Tooltip>のバースト制限をサブスクリプションごとに見ていきましょう。

<table class="table"><thead>
<tr>
<th>テナントタイプ</th>
<th>持続RPS</th>
<th>最大RPS</th>
<th>バーストRPM（ピーク時）</th>
</tr>
</thead>
<tbody>
<tr>
<td>無料/試用版</td>
<td><strong>2</strong></td>
<td>10</td>
<td>120</td>
</tr>
<tr>
<td>セルフサービス（有料）</td>
<td><strong>16</strong></td>
<td>50</td>
<td>1000</td>
</tr>
<tr>
<td>エンタープライズ（運用）</td>
<td><strong>16</strong></td>
<td>50</td>
<td>1000</td>
</tr>
<tr>
<td>エンタープライズ（非運用）</td>
<td><strong>1未満</strong></td>
<td>2</td>
<td>10</td>
</tr>
</tbody>
</table>

上のテーブルに表示される項目は以下のとおりです。

* **持続した要求（秒単位）** ：数分以上にわたる要求のレート制限（秒単位）。時間とともに考慮すべき最も重要な制限です。この値を超えなければ、トラフィックが制限されることはありません。超えると、超えた程度に応じて、バースト制限にどれだけ速くに到達するかが決まります。
* **最大要求（秒単位）** ：テナントが処理できる要求数（秒単位）の絶対制限。この制限値を超えることはできません。
* **分単位のバースト（ピーク）** ：要求の制限「バケット」のサイズ。

Enterprise制限を調べてみると、以下のことがわかります。

持続した要求（秒単位）16
最大要求（秒単位）50
分単位のバースト（ピーク）1000

この例では、分単位のバースト（ピーク）は1000です。つまり、「バケット」`size` (**x**)が1000で、`per_minute`レート（**y**）も1000です。1分経過するたびに、 `y`件の要求（**60/y**）のアクセス許可が追加されるため、計算式は「60/1000 = 0.06」となります。したがって、Auth0は0.06秒ごとに1つの要求をバケットに追加し、16.67の要求が1秒ごとにバケットに追加されます（1/.06 = 16.67）。

これまで学習した内容をまとめます。

* Enterpriseアプリケーションが1秒間（rps）に50件を超える要求を行うことはできません。
* Enterpriseアプリケーションには、最大50 rpsで消費できる1000件の要求の「バケット」 があります。
* 時間の経過とともに、平均16.67 rpsを超えないようにする必要があります。

要求のレートが1秒あたり16.67件の要求を超えて上昇すると、バースト制限に達し、「バケット」が枯渇する速度が加速します。では、バケットはどれだけ速く枯渇するのでしょうか?それは、アプリケーションが行う1秒あたりの要求数によって決まります。
Enterpriseアプリケーションで1秒あたりに30件の要求を行い、トラフィックが制限されるまで、この状態をどれだけ続けることができるのか知りたいとしましょう。すでに以下のことはわかっています。

* Enterpriseアプリケーションの「バケット」には、1000件の要求が含まれている。
* Auth0は、1秒あたり（+16.67 rps）16.67件の要求を「バケット」に追加する。

そして、1秒あたり30件の要求（-30 rps）がバケットから削除されることも判明しています。これらを考慮すると、バケットの枯渇レートは16.67 + (-30) = -13.33となります。この数値はマイナスの数値であるため、バケットは1秒あたり13.33件の要求のレートで枯渇されています。

バケットがどれだけ速く枯渇するかを割り出すには、「バケット」内の要求数（xまたは1000）をバケットが枯渇する1秒あたりの要求
数（13.33）で割ります。つまり、1000件の要求数/13.33件の要求数（秒単位） = 75秒となり、バケットは1秒あたり30件の要求のレートで、要求の75秒後に枯渇します。

この計算式を様々な要求レートで実行すると、以下のことがわかります。

* 16 rpsでは、「バケット」は枯渇することはない。
* 30 rpsでは、「バケット」は最大75秒で枯渇する。
* 50 rpsでは、「バケット」は最大30秒で枯渇する。

バースト制限に達し、「バケット」が枯渇すると、有効なレート制限はトラフィックが一定期間、16.67 rpsを下回るまで、1秒あたり16.67件の要求に制限されます。

したがって、この例では、Enterpriseアプリケーションは1秒あたり50件の要求を行いますが、その過程で、30秒ほどで「バケット」内の要求数を消費し、1秒あたり約16件の要求に制限されます。しかし、トラフィックの間隔を1秒あたりちょうど16件の要求に空けると、レート制限に達することはありません。