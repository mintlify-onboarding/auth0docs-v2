---
title: "Django APIアプリケーションに認可を追加する"
permalink: "interactive"
'description': "このチュートリアルは、Djangoを使ってビルドされたPython APIに認可を追加する方法を説明します。"
'og:title': "Django APIアプリケーションに認可を追加する"
'og:description': "このチュートリアルは、Djangoを使ってビルドされたPython APIに認可を追加する方法を説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/django.png"
'twitter:title': "Django APIアプリケーションに認可を追加する"
'twitter:description': "このチュートリアルは、Djangoを使ってビルドされたPython APIに認可を追加する方法を説明します。"
sidebarTitle: Django API
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Validator from "/snippets/quickstart/backend/django/validator.py.mdx";
import Views from "/snippets/quickstart/backend/django/views.py.mdx";
import Urls from "/snippets/quickstart/backend/django/urls.py.mdx";

export const sections = [
  { id: "アクセス許可を定義する", title: "アクセス許可を定義する" },
  { id: "djangoにauth0の使用を構成する", title: "DjangoにAuth0の使用を構成する" },
  { id: "jwtバリデーターを作成する", title: "JWTバリデーターを作成する" },
  { id: "apiビューを作成する", title: "APIビューを作成する" },
  { id: "urlマッピングを追加する", title: "URLマッピングを追加する" }
]

<Recipe>
  <Content>
    このガイドは、[Django](https://www.djangoproject.com/)を使ってビルドされた新規または既存のPython APIアプリケーションにAuth0を統合する方法を説明します。

    Auth0 DashboardでAPIをまだ作成していない場合は、対話型のセレクターを使ってAuth0 APIを新規作成します。そうでない場合は、統合したいプロジェクトを表す既存のAPIを選択することができます。

    または、Auth0 Dashboardを使って初めてAPIをセットアップする方法を使用の開始ガイドで確認することもできます。

    Auth0にあるAPIはそれぞれAPI識別子を使って構成され、アプリケーションのコードはAPI識別子をオーディエンスとしてアクセストークンを検証します。

    <Info>
    **Auth0を初めてご利用ですか？** Auth0の仕組みと、OAuth 2.0フレームワークを用いたAPI認証と認可の実装について説明します。
    </Info>

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      アクセス許可は、ユーザーの代わりに、提供されたアクセストークンを使ってどのようにしてリソースにアクセスできるのかを定義できるようにします。たとえば、ユーザーがマネージャーアクセスレベルを持つ場合には、`messages`リソースに対して読み取りアクセスを付与し、管理者アクセスレベルを持つ場合には、書き込みアクセスを付与することができます。

      Auth0 Dashboardの[［API］](https://manage.auth0.com/#/apis)セクションにある**［Permissions（権限）］** ビューで使用可能なアクセス許可を定義することができます。以下の例では`read:messages`スコープを使用します。

      <Frame>![［Auth0 Dashboard］>［Applications（アプリケーション）］>［APIs］>［Specific API（特定のAPI］>［Permissions（権限）］タブ](/images/ja-jp/cdy7uua7fh8z/1s3Yp5zqJiKiSWqbPSezNO/acef814282795bef6921535f044f96e9/Quickstarts_API.png)</Frame>
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      ### 依存関係をインストールする

      1. `requirements.txt`に次の依存関係を追加します：
      2. `pip install -r requirements.txt`を実行する

      ### Djangoアプリケーションを作成する
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      [Authlib](https://github.com/lepture/authlib)という名前のライブラリーを使用して、[ResourceProtector](https://docs.authlib.org/en/latest/flask/1/resource-server.html)を作成します。これは[Djangoビューのデコレーター](https://docs.djangoproject.com/en/4.0/topics/http/decorators/)の一種で、該当するバリデーターを使ってリソース（APIビュー）を保護します。

      バリデーターは、リソースに渡すアクセストークンに有効な署名とクレームがあることを確認して検証します。

      AuthLibの`JWTBearerTokenValidator`バリデーターに多少の変更を加えて、[アクセストークンの検証](/ja-jp/secure/tokens/access-tokens/validate-access-tokens)要件が満たされるようにします。

      `Auth0JWTBearerTokenValidator`を作成するには、`domain`と`audience`（API識別子）に渡すことが必要です。そうすると、トークンの署名を検証するのに必要な公開鍵が取得され、`JWTBearerTokenValidator`クラスに渡されます。

      そして、クラスの`claims_options`をオーバーライドし、トークンの`expiry`、`audience`、`issue`クレームが要件を満たして有効であることを確認します。

      インタラクティブパネルからのコードを利用して、`apiexample/validator.py`ファイルを作成します。
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      次に、`apiexample/views.py`に3つのAPIビューを作成します：

      - `/api/public`：認証を必要としないパブリックエンドポイントです。
      - `/api/private`：有効なJWTを必要とするプライベートエンドポイントです。
      - `/api/private-scoped`：与えられた`scope`を含む有効なJWTを必要とするプライベートエンドポイントです。

      保護されたルートには`require_auth`デコレーターがあり、これは、以前に作成した`Auth0JWTBearerTokenValidator`を使用する`ResourceProtector`です。

      `Auth0JWTBearerTokenValidator`を作成するには、テナントのドメインと以前に作成したAPIのAPI識別子に渡します。

      `private_scoped`ルートの`require_auth`デコレーターは、追加の引数である`"read:messages"`を受け付けます。これは、以前に作成したアクセス許可（スコープ）について、アクセストークンをチェックします。
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      前の手順では、`views.py`ファイルにメソッドを追加しました。次に、Djangoの[URL dispatcher](https://docs.djangoproject.com/en/4.0/topics/http/urls/)を使用して、それらのメソッドをURLへマッピングします。URL dispatcherでは、URLパターンをビューにマッピングすることができます。

      `apiexample/urls.py`ファイルにURLパターンを追加します。

      ### APIを呼び出す

      APIを呼び出すにはアクセストークンが必要です。テスト用のアクセストークンは、[APIの設定](https://manage.auth0.com/#/apis)の**［Test（テスト）］** ビューから取得することができます。

      <Frame>![［Auth0 Dashboard］>［Applications（アプリケーション）］>［API］>［Specific API（特定のAPI］>［Test（テスト）］タブ](/images/ja-jp/cdy7uua7fh8z/6jeVBuypOGX5qMRXeJn5ow/dd20eb74e1e9079287762ce33dcf8e2d/Quickstart_Example_App_API.png)</Frame>

      要求の`Authorization`ヘッダーにアクセストークンを指定します。

      <CodeGroup>
      ```bash cURL lines
      curl --request get \
      --url 'http:///%7ByourDomain%7D.com/api_path' \
      --header 'authorization: Bearer YOUR_ACCESS_TOKEN_HERE'
      ```
      ```csharp C# lines
      var client = new RestClient("http:///%7ByourDomain%7D.com/api_path");
      var request = new RestRequest(Method.GET);
      request.AddHeader("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE");
      IRestResponse response = client.Execute(request);
      ```

      ```go Go lines
      package main
      import (
      "fmt"
      "net/http"
      "io/ioutil"
      )
      func main() {
      url := "http:///%7ByourDomain%7D.com/api_path"
      req, _ := http.NewRequest("get", url, nil)
      req.Header.Add("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE")
      res, _ := http.DefaultClient.Do(req)
      defer res.Body.Close()
      body, _ := ioutil.ReadAll(res.Body)
      fmt.Println(res)
      fmt.Println(string(body))
      }
      ```

      ```java Java lines
      HttpResponse<String> response = Unirest.get("http:///%7ByourDomain%7D.com/api_path")
      .header("authorization", "Bearer YOUR_ACCESS_TOKEN_HERE")
      .asString();
      ```

      ```javascript Node.JS lines
      var axios = require("axios").default;
      var options = {
      method: 'get',
      url: 'http:///%7ByourDomain%7D.com/api_path',
      headers: {authorization: 'Bearer YOUR_ACCESS_TOKEN_HERE'}
      };
      axios.request(options).then(function (response) {
      console.log(response.data);
      }).catch(function (error) {
      console.error(error);
      });
      ```
      ```obj-c Obj-C lines
      #import <Foundation/Foundation.h>
      NSDictionary *headers = @{ @"authorization": @"Bearer YOUR_ACCESS_TOKEN_HERE" };
      NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http:///%7ByourDomain%7D.com/api_path"]
                                                        cachePolicy:NSURLRequestUseProtocolCachePolicy

                                                    timeoutInterval:10.0];

      [request setHTTPMethod:@"get"];
      [request setAllHTTPHeaderFields:headers];
      NSURLSession *session = [NSURLSession sharedSession];
      NSURLSessionDataTask *dataTask = [session dataTaskWithRequest:request
                                              completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {

                                                  if (error) {

                                                      NSLog(@&quot;%@&quot;, error);

                                                  } else {

                                                      NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *) response;

                                                      NSLog(@&quot;%@&quot;, httpResponse);

                                                  }

                                              }];

      [dataTask resume];
      ```

      ```php PHP lines
      $curl = curl_init();
      curl_setopt_array($curl, [
      CURLOPT_URL => "http:///%7ByourDomain%7D.com/api_path",
      CURLOPT_RETURNTRANSFER => true,
      CURLOPT_ENCODING => "",
      CURLOPT_MAXREDIRS => 10,
      CURLOPT_TIMEOUT => 30,
      CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
      CURLOPT_CUSTOMREQUEST => "get",
      CURLOPT_HTTPHEADER => [
      &quot;authorization: Bearer YOUR_ACCESS_TOKEN_HERE&quot;

      ],
      ]);
      $response = curl_exec($curl);
      $err = curl_error($curl);
      curl_close($curl);
      if ($err) {
      echo "cURL Error #:" . $err;
      } else {
      echo $response;
      }
      ```
      ```python Python lines
      import http.client
      conn = http.client.HTTPConnection("")
      headers = { 'authorization': "Bearer YOUR_ACCESS_TOKEN_HERE" }
      conn.request("get", "/dev-gja8kxz4ndtex3rq.us.auth0.com.com/api_path", headers=headers)
      res = conn.getresponse()
      data = res.read()
      print(data.decode("utf-8"))
      ```

      ```ruby Ruby lines
      require 'uri'
      require 'net/http'
      url = URI("http:///%7ByourDomain%7D.com/api_path")
      http = Net::HTTP.new(url.host, url.port)
      request = Net::HTTP::Get.new(url)
      request["authorization"] = 'Bearer YOUR_ACCESS_TOKEN_HERE'
      response = http.request(request)
      puts response.read_body
      ```
      ```swift Swift lines
      import Foundation
      let headers = ["authorization": "Bearer YOUR_ACCESS_TOKEN_HERE"]
      let request = NSMutableURLRequest(url: NSURL(string: "http:///%7ByourDomain%7D.com/api_path")! as URL,
                                          cachePolicy: .useProtocolCachePolicy,

                                      timeoutInterval: 10.0)

      request.httpMethod = "get"
      request.allHTTPHeaderFields = headers
      let session = URLSession.shared
      let dataTask = session.dataTask(with: request as URLRequest, completionHandler: { (data, response, error) -> Void in
      if (error != nil) {
      print(error)

      } else {
      let httpResponse = response as? HTTPURLResponse

      print(httpResponse)

      }
      })
      dataTask.resume()
      ```
      </CodeGroup>

      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <CodeGroup>
          <Views/>
          <Validator/>
          <Urls/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <CodeGroup>
          <Validator/>
          <Views/>
          <Urls/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
          <Urls/>
          <Validator/>
          <Views/>
        </CodeGroup>
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
