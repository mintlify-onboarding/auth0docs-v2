---
title: ".NET AndroidまたはiOSアプリケーションにログインを追加する"
permalink: "interactive"
'description': "このチュートリアルは、Auth0を使用して、.NET AndroidまたはiOSアプリケーションにユーザーログインを追加する方法について説明します。"
'og:title': ".NET AndroidまたはiOSアプリケーションにログインを追加する"
'og:description': "このチュートリアルは、Auth0を使用して、.NET AndroidまたはiOSアプリケーションにユーザーログインを追加する方法について説明します。"
'og:image': "https://cdn2.auth0.com/docs/1.14567.0/media/platforms/xamarin.png"
'twitter:title': ".NET AndroidまたはiOSアプリケーションにログインを追加する"
'twitter:description': "このチュートリアルは、Auth0を使用して、.NET AndroidまたはiOSアプリケーションにユーザーログインを追加する方法について説明します。"
sidebarTitle: .NET Android and iOS
---

import { Recipe, Content, Section, SideMenu, SideMenuSectionItem, SignUpForm } from "/snippets/recipe.jsx";
import { LoggedInForm } from "/snippets/Login.jsx";
import Mainactivity from "/snippets/quickstart/native/net-android-ios/MainActivity.cs.mdx";
import Appdelegate from "/snippets/quickstart/native/net-android-ios/AppDelegate.cs.mdx";
import Myviewcontroller from "/snippets/quickstart/native/net-android-ios/MyViewController.cs.mdx";

export const sections = [
  { id: "auth0を構成する", title: "Auth0を構成する" },
  { id: "auth0-sdkをインストールする", title: "Auth0 SDKをインストールする" },
  { id: "auth0clientをインスタンス化する", title: "Auth0Clientをインスタンス化する" },
  { id: "androidを構成する", title: "Androidを構成する" },
  { id: "iosを構成する", title: "iOSを構成する" },
  { id: "アプリケーションにログインを追加する", title: "アプリケーションにログインを追加する" },
  { id: "アプリケーションにログアウトを追加する", title: "アプリケーションにログアウトを追加する" },
  { id: "ユーザープロファイル情報を表示する", title: "ユーザープロファイル情報を表示する" }
]

<Recipe>
  <Content>
    Auth0を使用すると、アプリケーションに手軽に認証を追加することができます。このガイドは、.NET AndroidまたはiOSアプリケーションに[Android](https://www.nuget.org/packages/Auth0.OidcClient.AndroidX/)や[iOS](https://www.nuget.org/packages/Auth0.OidcClient.iOS)用のAuth0 SDKを使ってAuth0を統合し、認証の追加とユーザープロファイル情報の表示を行う方法について説明します。

    <Info>
    このクイックスタートは、`Xamarin.Android`と`Xamarin.iOS`の次世代である.NET AndroidとiOSについて説明します。現在、`Xamarin.Android`や`Xamarin.iOS`を使用している場合は、統合が同一でSDKにも互換性があるため、このガイドに従ってください。
    </Info>

    このクイックスタートを使用するには、以下の手順に従います：

    - Auth0の無料アカウントにサインアップするか、Auth0にログインします。
    - 統合したいAndroidまたはiOSのプロジェクトで、.NET 6以降を使用したものを用意します。または、ログインした後に、サンプルアプリケーションを表示してダウンロードすることもできます。

      <Section id={sections[0].id} title={sections[0].title} stepNumber="1">
      Auth0のサービスを利用するには、Auth0 Dashboadに設定済みのアプリケーションがある必要があります。Auth0アプリケーションは、プロジェクトに対してどのように認証が動作して欲しいかを構成する場所です。

      ### アプリケーションを構成する

      対話型のセレクターを使って「ネイティブアプリケーション」を新規作成するか、統合したいプロジェクトを表す既存のアプリケーションを選択します。Auth0のすべてのアプリケーションには英数字からなる一意のクライアントIDが割り当てられており、アプリケーションのコードがSDKを通じてAuth0 APIを呼び出す際に使用されます。

      このクイックスタートを使って構成されたすべての設定は、[Dashboard](https://manage.auth0.com/#/)のアプリケーションを自動更新します。今後、アプリケーションの管理もDashboardで行えます。

      完了済みの構成を見てみたい場合は、サンプルアプリケーションをご覧ください。

      ### Callback URLを構成する

      Callback URLとは、Auth0がユーザーを認証後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはログイン後にアプリケーションに戻りません。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、プラットフォームに応じて、これを次のURLの1つに設定します：

      - **Android** ：`YOUR_PACKAGE_NAME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback`
      - **iOS** ：`YOUR_BUNDLE_ID://{yourDomain}/ios/YOUR_BUNDLE_ID/callback`
      </Info>

      ### ログアウトURLを構成する

      ログアウトURLとは、Auth0がユーザーをログアウト後にリダイレクトするアプリケーション内URLです。設定されていない場合、ユーザーはアプリケーションからログアウトできず、エラーを受け取ります。

      <Info>
      サンプルプロジェクトに沿って進めている場合は、プラットフォームに応じて、これを次のURLの1つに設定します：

      - **Android** ：`YOUR_PACKAGE_NAME://{yourDomain}/android/YOUR_PACKAGE_NAME/callback`
      - **iOS** ：`YOUR_BUNDLE_ID://{yourDomain}/ios/YOUR_BUNDLE_ID/callback`
      </Info>

      最後に、アプリケーションの**［Application Type（アプリケーションタイプ）］** が**［Native（ネイティブ）］** になっていることを[アプリケーションの設定](https://manage.auth0.com/#/applications/)で必ず確認してください。
      </Section>

      <Section id={sections[1].id} title={sections[1].title} stepNumber="2">
      .NET AndroidとiOSアプリケーションで、Auth0認証が手軽に実装できるように、Auth0は[Android](https://www.nuget.org/packages/Auth0.OidcClient.AndroidX/)と[iOS](https://www.nuget.org/packages/Auth0.OidcClient.iOS)のSDKを提供しています。

      NuGetパッケージマネージャ（［Tools（ツール）］ -> ［Library Package Manager（ライブラリーパッケージマネージャー）］ -> ［Package Manager Console（パッケージマネージャーコンソール）］）を使用して、AndroidまたはiOSアプリケーションのどちらをビルドするかに応じて、`Auth0.OidcClient.AndroidX`または`Auth0.OidcClient.iOS`パッケージをインストールします。

      NuGetパッケージマネージャーコンソール（`Install-Package`）や`dotnet` CLI（`dotnet add`）を代わりに使用することもできます。

      ```
      Install-Package Auth0.OidcClient.AndroidX
      Install-Package Auth0.OidcClient.iOS
      ```

      ```
      dotnet add Auth0.OidcClient.AndroidX
      dotnet add Auth0.OidcClient.iOS
      ```
      </Section>

      <Section id={sections[2].id} title={sections[2].title} stepNumber="3">
      Auth0をアプリケーションに統合するには、Auth0のドメインとクライアントIDを含む`Auth0ClientOptions`のインスタンスを渡して、`Auth0Client`クラスをインスタンス化します。

      ```
      using Auth0.OidcClient;
      var client = new Auth0Client(new Auth0ClientOptions {
      Domain = "{yourDomain}",
      ClientId = "{yourClientId}"
      }, this);
      ```

      SDKは初期設定で、AndroidにはChrome Custom Tabs、iOSにはASWebAuthenticationSessionを利用します。

      <Note>
      ##### チェックポイント
      Auth0Clientが適切にインスタンス化されました。アプリケーションを実行して次の点を確認します：
      Auth0ClientのインスタンスがActivity（Android）またはUIViewController（iOS）で正しく作成されている。
      アプリケーションがAuth0に関連したエラーを投入していない。
      </Note>
      </Section>

      <Section id={sections[3].id} title={sections[3].title} stepNumber="4">
      ユーザーが認証に成功すると、このクイックスタートで前にセットアップしたCallback URLへリダイレクトされます。

      Androidデバイスでコールバックを扱うには、Callback URLを扱うインテントを登録する必要があります。これを手軽に実現するには、認証フローをインスタンス化するためにLoginAsyncメソッドを呼び出したのと同じアクティビティーにインテントを登録します。

      必ず、サンプルコードにある`YOUR_ANDROID_PACKAGE_NAME`は実際のアプリケーションのパッケージ名（`com.mycompany.myapplication`など）で置き換えてください。また、`DataScheme`、`DataHost`、`DataPathPrefix`のテキストがすべて小文字であることを確認してください。アクティビティーには`LaunchMode = LaunchMode.SingleTask`を設定します。設定しないと、Callback URLが呼び出されるたびに、システムがアクティビティーの新しいインスタンスを作成します。

      また、`Activity`クラスにある`OnNewIntent`イベントでインテントを扱う必要があります。`ActivityMediator`シングルトンの`Send`メソッドを呼び出して受け取ったURLを渡し、Auth0のOIDCクライアントに認証フローを終わらせるよう通知する必要があります。

      ```
      protected override void OnNewIntent(Intent intent)
      {

          base.OnNewIntent(intent);

          ActivityMediator.Instance.Send(intent.DataString);

      }
      ```
      </Section>

      <Section id={sections[4].id} title={sections[4].title} stepNumber="5">
      ユーザーが認証に成功すると、このクイックスタートで前にセットアップしたCallback URLへリダイレクトされます。

      iOSデバイスでコールバックを扱うには、以下を行います：

      1. アプリケーションの`Info.plist`ファイルをVisual Studioで開いて、**［Advanced（詳細）］** タブに移動します。
      2. **［URL Types（URLタイプ）］** にある**［Add URL Type（URLタイプの追加）］** ボタンをクリックします。
      3. **識別子** をAuth0、**URLスキーマ** をアプリケーションの`バンドル識別子`、**ロール** を`［None（なし）］`に設定します。

      これは、URLタイプを追加した後でXML表記された`info.plist`ファイルの例です：

      ```xml
      <key>CFBundleURLTypes</key>
      <array>
      <dict>
      <key>CFBundleTypeRole</key>
      <string>None</string>
      <key>CFBundleURLName</key>
      <string>Auth0</string>
      <key>CFBundleURLSchemes</key>
      <array>
      <string>YOUR_BUNDLE_IDENTIFIER</string>
      </array>
      </dict>
      </array>
      ```

      さらに、`AppDelegate`クラスにある`OpenUrl`イベントでCallback URLを扱う必要があります。`ActivityMediator`シングルトンの`Send`メソッドを呼び出して受け取ったURLを渡し、Auth0のOIDCクライアントに認証フローを終わらせるよう通知する必要があります。
      </Section>

      <Section id={sections[5].id} title={sections[5].title} stepNumber="6">
      Auth0アプリケーションとAuth0 SDKの構成が完了したら、プロジェクトのためにログインをセットアップする必要があります。これを実現するには、SDKの`LoginAsync()`メソッドを使用して、ユーザーをAuth0のユニバーサルログインページにリダイレクトするログインボタンを作成します。

      ```js
      var loginResult = await client.LoginAsync();
      ```

      エラーがなければ、`LoginAsync()`が返す`LoginResult`で`User`、`IdentityToken`、`AccessToken`、`RefreshToken`にアクセスすることができます。

      <Note>
      ##### チェックポイント
      ユーザー名とパスワードを使ってログインやサインアップができるようになりました。
      ログインボタンをクリックして次の点を確認します：
      AndroidまたはiOSアプリケーションによってAuth0のユニバーサルログインページにリダイレクトされる。
      ログインまたはサインアップできる。
      Auth0によってアプリケーションにリダイレクトされる。
      </Note>
      </Section>

      <Section id={sections[6].id} title={sections[6].title} stepNumber="7">
      プロジェクトにログインしたユーザーには、ログアウトする方法も必要です。SDKの`LogoutAsync()`メソッドを使用してログアウトボタンを作成します。ユーザーはログアウトすると、Auth0ログアウトエンドポイントにリダイレクトされてから、即座に、このクイックスタートで先ほどセットアップしたログアウトURLにリダイレクトで戻されます。

      ```
      await client.LogoutAsync();
      ```

      <Note>
      ##### チェックポイント
      アプリケーションを実行して、ログアウトボタンをクリックします。以下の点を確認します：
      AndroidまたはiOSアプリケーションによって、アプリケーションの設定で［Allowed Logout URLs（許可されているログアウトURL）］の1つに指定されているアドレスへリダイレクトされる。
      アプリケーションにログインしていない。
      </Note>
      </Section>

      <Section id={sections[7].id} title={sections[7].title} stepNumber="8">
      ユーザーがログインやログアウトできるようになったら、認証済のユーザーに関連付けられたプロファイル情報を取得できるようにしたいと考えるはずです。たとえば、ログインしたユーザーの名前やプロフィール写真をプロジェクトに表示したいかもしれません。

      AndroidまたはiOS用のAuth0 SDKでは、`LoginResult.User`プロパティを通じてユーザー情報を提供します。

      ```
      if loginResult.IsError == false {
      var user = loginResult.User
      var name = user.FindFirst(c => c.Type == "name")?.Value
      var email = user.FindFirst(c => c.Type == "email")?.Value
      var picture = user.FindFirst(c => c.Type == "picture")?.Value
      }
      ```
      </Section>

    ## 次のステップ

    成功です！ここまで来れば、アプリケーションにログイン、ログアウト、ユーザープロファイル情報が備わっているはずです。

    これでクイックスタートチュートリアルは終了ですが、機能はまだまだたくさんあります。Auth0でできることについて詳しくは、以下をご覧ください。

    *   [Auth0 Dashboard](https://manage.auth0.com/#) - Auth0のテナントやアプリケーションを構成して管理する方法について説明します
    *   [auth0-oidc-client-net SDK](https://github.com/auth0/auth0-oidc-client-net) - このチュートリアルで使用されているSDKをより詳しく説明します
    *   [Auth0 Marketplace](https://marketplace.auth0.com/) - Auth0の機能性を拡張できる各種の統合を見つけられます
  </Content>

  <SideMenu sections={sections}>
      <SideMenuSectionItem id={sections[0].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[1].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[2].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[3].id}>
        <CodeGroup>
          <Mainactivity/>
          <Appdelegate/>
          <Myviewcontroller/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[4].id}>
        <CodeGroup>
          <Appdelegate/>
          <Mainactivity/>
          <Myviewcontroller/>
        </CodeGroup>
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[5].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[6].id}>
        <SignUpForm />
      </SideMenuSectionItem>

      <SideMenuSectionItem id={sections[7].id}>
        <SignUpForm />
      </SideMenuSectionItem>

    </SideMenu>
</Recipe>
