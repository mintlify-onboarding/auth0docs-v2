

export const AuthDocsPipeline = ({ activeId }) => {
  const [hoveredId, setHoveredId] = useState(null);

  const VB_WIDTH  = 1202;
  const VB_HEIGHT = 424;

  const AUTH_GROUP   = new Set(['authenticate', 'provision-db', 'provision-social', 'add-login']);
  const CUSTOM_GROUP = new Set(['customize', 'brand', 'actions', 'extensions']);

  const STEPS = [
    { id: 'get-started',      href: '/docs/get-started',                         cx:  53.7447, cy: 140.5572, r: 52 },
    { id: 'authenticate',     href: '/docs/authenticate',                        cx: 239.164,  cy: 140.5572, r: 52 },
    { id: 'manage-users',     href: '/docs/manage-users',                        cx: 515.135,  cy: 140.5572, r: 52 },
    { id: 'customize',        href: '/docs/customize',                           cx: 791.106,  cy: 140.5572, r: 52 },
    { id: 'deploy',           href: '/docs/deploy-monitor',                      cx:1147.57,   cy: 140.5572, r: 52 },
    { id: 'secure',           href: '/docs/secure',                              cx: 974,      cy: 224,      r: 44 },
    { id: 'provision-db',     href: '/docs/authenticate#provision–database',     cx:  67,      cy: 410,      r: 42 },
    { id: 'provision-social', href: '/docs/authenticate#provision–social',       cx: 167,      cy: 410,      r: 42 },
    { id: 'add-login',        href: '/docs/authenticate#add-login',              cx: 312,      cy: 410,      r: 42 },
    { id: 'brand',            href: '/docs/customize#brand',                     cx: 720,      cy: 410,      r: 42 },
    { id: 'actions',          href: '/docs/customize#actions',                   cx: 864,      cy: 410,      r: 42 },
    { id: 'extensions',       href: '/docs/customize#extensions',                cx: 964,      cy: 410,      r: 42 },
  ];

  const addGroupToSet = (id, set) => {
    if (!id) return;
    if (AUTH_GROUP.has(id)) {
      AUTH_GROUP.forEach((gid) => set.add(gid));
    } else if (CUSTOM_GROUP.has(id)) {
      CUSTOM_GROUP.forEach((gid) => set.add(gid));
    } else {
      set.add(id);
    }
  };

  const lit = new Set();
  addGroupToSet(activeId, lit);
  addGroupToSet(hoveredId, lit);

  return (
    <div className="pipeline-wrapper">
      <img
        src="/docs/images/site-graph.svg"
        alt="Auth0 docs pipeline"
        className="pipeline-img block dark:hidden"
        noZoom
      />
      <img
        src="/docs/images/site-graph-dark.svg"
        alt="Auth0 docs pipeline"
        className="pipeline-img hidden dark:block"
        noZoom
      />

      {STEPS.map(({ id, cx, cy, r }) => {
        if (lit.has(id)) return null;
        const left  = ((cx - r) / VB_WIDTH)  * 100;
        const top   = ((cy - r) / VB_HEIGHT) * 100;
        const size  = ((2 * r)  / VB_WIDTH)  * 100;
        return (
          <div
            key={`dim-${id}`}
            className="pipeline-dim-circle"
            style={{ left: `${left}%`, top: `${top}%`, width: `${size}%` }}
          />
        );
      })}

      {STEPS.map(({ id, href, cx, cy, r }) => {
        const left  = ((cx - r) / VB_WIDTH)  * 100;
        const top   = ((cy - r) / VB_HEIGHT) * 100;
        const size  = ((2 * r)  / VB_WIDTH)  * 100;
        return (
          <a
            key={id}
            href={href}
            aria-label={id}
            className={`pipeline-hotspot${lit.has(id) ? ' lit' : ''}`}
            style={{ left: `${left}%`, top: `${top}%`, width: `${size}%` }}
            onMouseEnter={() => setHoveredId(id)}
            onMouseLeave={() => setHoveredId(null)}
          />
        );
      })}
    </div>
  );
};
